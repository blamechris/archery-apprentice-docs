<!DOCTYPE html>
<html lang="en" dir="ltr"><head><title>Equipment Management End to End Flow</title><meta charset="utf-8"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Schibsted Grotesk:wght@400;700&amp;family=Source Sans Pro:ital,wght@0,400;0,600;1,400;1,600&amp;family=IBM Plex Mono:wght@400;600&amp;display=swap"/><link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin="anonymous"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="og:site_name" content="Archery Apprentice Documentation"/><meta property="og:title" content="Equipment Management End to End Flow"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Equipment Management End to End Flow"/><meta name="twitter:description" content="equipment management complete flow"/><meta property="og:description" content="equipment management complete flow"/><meta property="og:image:alt" content="equipment management complete flow"/><meta property="twitter:domain" content="blamechris.github.io/archery-apprentice-docs"/><meta property="og:url" content="https://blamechris.github.io/archery-apprentice-docs/developer-guide/technical-reference/flows/equipment-management-end-to-end-flow"/><meta property="twitter:url" content="https://blamechris.github.io/archery-apprentice-docs/developer-guide/technical-reference/flows/equipment-management-end-to-end-flow"/><link rel="icon" href="../../../static/icon.png"/><meta name="description" content="equipment management complete flow"/><meta name="generator" content="Quartz"/><link href="../../../index.css" rel="stylesheet" type="text/css" spa-preserve/><style>.expand-button {
  position: absolute;
  display: flex;
  float: right;
  padding: 0.4rem;
  margin: 0.3rem;
  right: 0;
  color: var(--gray);
  border-color: var(--dark);
  background-color: var(--light);
  border: 1px solid;
  border-radius: 5px;
  opacity: 0;
  transition: 0.2s;
}
.expand-button > svg {
  fill: var(--light);
  filter: contrast(0.3);
}
.expand-button:hover {
  cursor: pointer;
  border-color: var(--secondary);
}
.expand-button:focus {
  outline: 0;
}

pre:hover > .expand-button {
  opacity: 1;
  transition: 0.2s;
}

#mermaid-container {
  position: fixed;
  contain: layout;
  z-index: 999;
  left: 0;
  top: 0;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  display: none;
  backdrop-filter: blur(4px);
  background: rgba(0, 0, 0, 0.5);
}
#mermaid-container.active {
  display: inline-block;
}
#mermaid-container > #mermaid-space {
  border: 1px solid var(--lightgray);
  background-color: var(--light);
  border-radius: 5px;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  height: 80vh;
  width: 80vw;
  overflow: hidden;
}
#mermaid-container > #mermaid-space > .mermaid-content {
  padding: 2rem;
  position: relative;
  transform-origin: 0 0;
  transition: transform 0.1s ease;
  overflow: visible;
  min-height: 200px;
  min-width: 200px;
}
#mermaid-container > #mermaid-space > .mermaid-content pre {
  margin: 0;
  border: none;
}
#mermaid-container > #mermaid-space > .mermaid-content svg {
  max-width: none;
  height: auto;
}
#mermaid-container > #mermaid-space > .mermaid-controls {
  position: absolute;
  bottom: 20px;
  right: 20px;
  display: flex;
  gap: 8px;
  padding: 8px;
  background: var(--light);
  border: 1px solid var(--lightgray);
  border-radius: 6px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  z-index: 2;
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  padding: 0;
  border: 1px solid var(--lightgray);
  background: var(--light);
  color: var(--dark);
  border-radius: 4px;
  cursor: pointer;
  font-size: 16px;
  font-family: var(--bodyFont);
  transition: all 0.2s ease;
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button:hover {
  background: var(--lightgray);
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button:active {
  transform: translateY(1px);
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button:nth-child(2) {
  width: auto;
  padding: 0 12px;
  font-size: 14px;
}
/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VSb290IjoiL2hvbWUvcnVubmVyL3dvcmsvYXJjaGVyeS1hcHByZW50aWNlLWRvY3MvYXJjaGVyeS1hcHByZW50aWNlLWRvY3MvcXVhcnR6L2NvbXBvbmVudHMvc3R5bGVzIiwic291cmNlcyI6WyJtZXJtYWlkLmlubGluZS5zY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0VBQ0U7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7O0FBRUE7RUFDRTtFQUNBOztBQUdGO0VBQ0U7RUFDQTs7QUFHRjtFQUNFOzs7QUFLRjtFQUNFO0VBQ0E7OztBQUlKO0VBQ0U7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTs7QUFFQTtFQUNFOztBQUdGO0VBQ0U7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7O0FBRUE7RUFDRTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTs7QUFFQTtFQUNFO0VBQ0E7O0FBR0Y7RUFDRTtFQUNBOztBQUlKO0VBQ0U7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTs7QUFFQTtFQUNFO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7O0FBRUE7RUFDRTs7QUFHRjtFQUNFOztBQUlGO0VBQ0U7RUFDQTtFQUNBIiwic291cmNlc0NvbnRlbnQiOlsiLmV4cGFuZC1idXR0b24ge1xuICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGZsb2F0OiByaWdodDtcbiAgcGFkZGluZzogMC40cmVtO1xuICBtYXJnaW46IDAuM3JlbTtcbiAgcmlnaHQ6IDA7IC8vIE5PVEU6IHJpZ2h0IHdpbGwgYmUgc2V0IGluIG1lcm1haWQuaW5saW5lLnRzXG4gIGNvbG9yOiB2YXIoLS1ncmF5KTtcbiAgYm9yZGVyLWNvbG9yOiB2YXIoLS1kYXJrKTtcbiAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tbGlnaHQpO1xuICBib3JkZXI6IDFweCBzb2xpZDtcbiAgYm9yZGVyLXJhZGl1czogNXB4O1xuICBvcGFjaXR5OiAwO1xuICB0cmFuc2l0aW9uOiAwLjJzO1xuXG4gICYgPiBzdmcge1xuICAgIGZpbGw6IHZhcigtLWxpZ2h0KTtcbiAgICBmaWx0ZXI6IGNvbnRyYXN0KDAuMyk7XG4gIH1cblxuICAmOmhvdmVyIHtcbiAgICBjdXJzb3I6IHBvaW50ZXI7XG4gICAgYm9yZGVyLWNvbG9yOiB2YXIoLS1zZWNvbmRhcnkpO1xuICB9XG5cbiAgJjpmb2N1cyB7XG4gICAgb3V0bGluZTogMDtcbiAgfVxufVxuXG5wcmUge1xuICAmOmhvdmVyID4gLmV4cGFuZC1idXR0b24ge1xuICAgIG9wYWNpdHk6IDE7XG4gICAgdHJhbnNpdGlvbjogMC4ycztcbiAgfVxufVxuXG4jbWVybWFpZC1jb250YWluZXIge1xuICBwb3NpdGlvbjogZml4ZWQ7XG4gIGNvbnRhaW46IGxheW91dDtcbiAgei1pbmRleDogOTk5O1xuICBsZWZ0OiAwO1xuICB0b3A6IDA7XG4gIHdpZHRoOiAxMDB2dztcbiAgaGVpZ2h0OiAxMDB2aDtcbiAgb3ZlcmZsb3c6IGhpZGRlbjtcbiAgZGlzcGxheTogbm9uZTtcbiAgYmFja2Ryb3AtZmlsdGVyOiBibHVyKDRweCk7XG4gIGJhY2tncm91bmQ6IHJnYmEoMCwgMCwgMCwgMC41KTtcblxuICAmLmFjdGl2ZSB7XG4gICAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xuICB9XG5cbiAgJiA+ICNtZXJtYWlkLXNwYWNlIHtcbiAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1saWdodGdyYXkpO1xuICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWxpZ2h0KTtcbiAgICBib3JkZXItcmFkaXVzOiA1cHg7XG4gICAgcG9zaXRpb246IGZpeGVkO1xuICAgIHRvcDogNTAlO1xuICAgIGxlZnQ6IDUwJTtcbiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKTtcbiAgICBoZWlnaHQ6IDgwdmg7XG4gICAgd2lkdGg6IDgwdnc7XG4gICAgb3ZlcmZsb3c6IGhpZGRlbjtcblxuICAgICYgPiAubWVybWFpZC1jb250ZW50IHtcbiAgICAgIHBhZGRpbmc6IDJyZW07XG4gICAgICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gICAgICB0cmFuc2Zvcm0tb3JpZ2luOiAwIDA7XG4gICAgICB0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gMC4xcyBlYXNlO1xuICAgICAgb3ZlcmZsb3c6IHZpc2libGU7XG4gICAgICBtaW4taGVpZ2h0OiAyMDBweDtcbiAgICAgIG1pbi13aWR0aDogMjAwcHg7XG5cbiAgICAgIHByZSB7XG4gICAgICAgIG1hcmdpbjogMDtcbiAgICAgICAgYm9yZGVyOiBub25lO1xuICAgICAgfVxuXG4gICAgICBzdmcge1xuICAgICAgICBtYXgtd2lkdGg6IG5vbmU7XG4gICAgICAgIGhlaWdodDogYXV0bztcbiAgICAgIH1cbiAgICB9XG5cbiAgICAmID4gLm1lcm1haWQtY29udHJvbHMge1xuICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgYm90dG9tOiAyMHB4O1xuICAgICAgcmlnaHQ6IDIwcHg7XG4gICAgICBkaXNwbGF5OiBmbGV4O1xuICAgICAgZ2FwOiA4cHg7XG4gICAgICBwYWRkaW5nOiA4cHg7XG4gICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1saWdodCk7XG4gICAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1saWdodGdyYXkpO1xuICAgICAgYm9yZGVyLXJhZGl1czogNnB4O1xuICAgICAgYm94LXNoYWRvdzogMCAycHggNHB4IHJnYmEoMCwgMCwgMCwgMC4xKTtcbiAgICAgIHotaW5kZXg6IDI7XG5cbiAgICAgIC5tZXJtYWlkLWNvbnRyb2wtYnV0dG9uIHtcbiAgICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7XG4gICAgICAgIHdpZHRoOiAzMnB4O1xuICAgICAgICBoZWlnaHQ6IDMycHg7XG4gICAgICAgIHBhZGRpbmc6IDA7XG4gICAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWxpZ2h0Z3JheSk7XG4gICAgICAgIGJhY2tncm91bmQ6IHZhcigtLWxpZ2h0KTtcbiAgICAgICAgY29sb3I6IHZhcigtLWRhcmspO1xuICAgICAgICBib3JkZXItcmFkaXVzOiA0cHg7XG4gICAgICAgIGN1cnNvcjogcG9pbnRlcjtcbiAgICAgICAgZm9udC1zaXplOiAxNnB4O1xuICAgICAgICBmb250LWZhbWlseTogdmFyKC0tYm9keUZvbnQpO1xuICAgICAgICB0cmFuc2l0aW9uOiBhbGwgMC4ycyBlYXNlO1xuXG4gICAgICAgICY6aG92ZXIge1xuICAgICAgICAgIGJhY2tncm91bmQ6IHZhcigtLWxpZ2h0Z3JheSk7XG4gICAgICAgIH1cblxuICAgICAgICAmOmFjdGl2ZSB7XG4gICAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKDFweCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBTdHlsZSB0aGUgcmVzZXQgYnV0dG9uIGRpZmZlcmVudGx5XG4gICAgICAgICY6bnRoLWNoaWxkKDIpIHtcbiAgICAgICAgICB3aWR0aDogYXV0bztcbiAgICAgICAgICBwYWRkaW5nOiAwIDEycHg7XG4gICAgICAgICAgZm9udC1zaXplOiAxNHB4O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59XG4iXX0= */</style><link href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" rel="stylesheet" type="text/css" spa-preserve/><script src="../../../prescript.js" type="application/javascript" spa-preserve></script><script type="application/javascript" spa-preserve>const fetchData = fetch("../../../static/contentIndex.json").then(data => data.json())</script><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="https://blamechris.github.io/archery-apprentice-docs/index.xml"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta property="og:image" content="https://blamechris.github.io/archery-apprentice-docs/developer-guide/technical-reference/flows/equipment-management-end-to-end-flow-og-image.webp"/><meta property="og:image:url" content="https://blamechris.github.io/archery-apprentice-docs/developer-guide/technical-reference/flows/equipment-management-end-to-end-flow-og-image.webp"/><meta name="twitter:image" content="https://blamechris.github.io/archery-apprentice-docs/developer-guide/technical-reference/flows/equipment-management-end-to-end-flow-og-image.webp"/><meta property="og:image:type" content="image/.webp"/></head><body data-slug="developer-guide/technical-reference/flows/equipment-management-end-to-end-flow"><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"><h2 class="page-title"><a href="../../..">Archery Apprentice Documentation</a></h2><div class="spacer mobile-only"></div><div class="flex-component" style="flex-direction: row; flex-wrap: nowrap; gap: 1rem;"><div style="flex-grow: 1; flex-shrink: 1; flex-basis: auto; order: 0; align-self: center; justify-self: center;"><div class="search"><button class="search-button"><svg role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title>Search</title><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path><circle cx="8" cy="8" r="7"></circle></g></svg><p>Search</p></button><div class="search-container"><div class="search-space"><input autocomplete="off" class="search-bar" name="search" type="text" aria-label="Search for something" placeholder="Search for something"/><div class="search-layout" data-preview="true"></div></div></div></div></div><div style="flex-grow: 0; flex-shrink: 1; flex-basis: auto; order: 0; align-self: center; justify-self: center;"><button class="darkmode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="dayIcon" x="0px" y="0px" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35" xml:space="preserve" aria-label="Dark mode"><title>Dark mode</title><path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5    S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5    C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6    C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9    c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44    l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5    c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06    L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z     M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2    C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29    c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7    C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5    c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="nightIcon" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background:new 0 0 100 100" xml:space="preserve" aria-label="Light mode"><title>Light mode</title><path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571  C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23  c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369  c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65  c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z"></path></svg></button></div><div style="flex-grow: 0; flex-shrink: 1; flex-basis: auto; order: 0; align-self: center; justify-self: center;"><button class="readermode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="readerIcon" fill="currentColor" stroke="currentColor" stroke-width="0.2" stroke-linecap="round" stroke-linejoin="round" width="64px" height="64px" viewBox="0 0 24 24" aria-label="Reader mode"><title>Reader mode</title><g transform="translate(-1.8, -1.8) scale(1.15, 1.2)"><path d="M8.9891247,2.5 C10.1384702,2.5 11.2209868,2.96705384 12.0049645,3.76669482 C12.7883914,2.96705384 13.8709081,2.5 15.0202536,2.5 L18.7549359,2.5 C19.1691495,2.5 19.5049359,2.83578644 19.5049359,3.25 L19.5046891,4.004 L21.2546891,4.00457396 C21.6343849,4.00457396 21.9481801,4.28672784 21.9978425,4.6528034 L22.0046891,4.75457396 L22.0046891,20.25 C22.0046891,20.6296958 21.7225353,20.943491 21.3564597,20.9931534 L21.2546891,21 L2.75468914,21 C2.37499337,21 2.06119817,20.7178461 2.01153575,20.3517706 L2.00468914,20.25 L2.00468914,4.75457396 C2.00468914,4.37487819 2.28684302,4.061083 2.65291858,4.01142057 L2.75468914,4.00457396 L4.50368914,4.004 L4.50444233,3.25 C4.50444233,2.87030423 4.78659621,2.55650904 5.15267177,2.50684662 L5.25444233,2.5 L8.9891247,2.5 Z M4.50368914,5.504 L3.50468914,5.504 L3.50468914,19.5 L10.9478955,19.4998273 C10.4513189,18.9207296 9.73864328,18.5588115 8.96709342,18.5065584 L8.77307039,18.5 L5.25444233,18.5 C4.87474657,18.5 4.56095137,18.2178461 4.51128895,17.8517706 L4.50444233,17.75 L4.50368914,5.504 Z M19.5049359,17.75 C19.5049359,18.1642136 19.1691495,18.5 18.7549359,18.5 L15.2363079,18.5 C14.3910149,18.5 13.5994408,18.8724714 13.0614828,19.4998273 L20.5046891,19.5 L20.5046891,5.504 L19.5046891,5.504 L19.5049359,17.75 Z M18.0059359,3.999 L15.0202536,4 L14.8259077,4.00692283 C13.9889509,4.06666544 13.2254227,4.50975805 12.7549359,5.212 L12.7549359,17.777 L12.7782651,17.7601316 C13.4923805,17.2719483 14.3447024,17 15.2363079,17 L18.0059359,16.999 L18.0056891,4.798 L18.0033792,4.75457396 L18.0056891,4.71 L18.0059359,3.999 Z M8.9891247,4 L6.00368914,3.999 L6.00599909,4.75457396 L6.00599909,4.75457396 L6.00368914,4.783 L6.00368914,16.999 L8.77307039,17 C9.57551536,17 10.3461406,17.2202781 11.0128313,17.6202194 L11.2536891,17.776 L11.2536891,5.211 C10.8200889,4.56369974 10.1361548,4.13636104 9.37521067,4.02745763 L9.18347055,4.00692283 L8.9891247,4 Z"></path></g></svg></button></div></div><div class="explorer" data-behavior="link" data-collapsed="collapsed" data-savestate="true" data-data-fns="{&quot;order&quot;:[&quot;filter&quot;,&quot;map&quot;,&quot;sort&quot;],&quot;sortFn&quot;:&quot;(a,b)=>!a.isFolder&amp;&amp;!b.isFolder||a.isFolder&amp;&amp;b.isFolder?a.displayName.localeCompare(b.displayName,void 0,{numeric:!0,sensitivity:\&quot;base\&quot;}):!a.isFolder&amp;&amp;b.isFolder?1:-1&quot;,&quot;filterFn&quot;:&quot;node=>node.slugSegment!==\&quot;tags\&quot;&quot;,&quot;mapFn&quot;:&quot;node=>node&quot;}"><button type="button" class="explorer-toggle mobile-explorer hide-until-loaded" data-mobile="true" aria-controls="explorer-134"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide-menu"><line x1="4" x2="20" y1="12" y2="12"></line><line x1="4" x2="20" y1="6" y2="6"></line><line x1="4" x2="20" y1="18" y2="18"></line></svg></button><button type="button" class="title-button explorer-toggle desktop-explorer" data-mobile="false" aria-expanded="true"><h2>Explorer</h2><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><div id="explorer-134" class="explorer-content" aria-expanded="false" role="group"><ul class="explorer-ul overflow" id="list-0"><li class="overflow-end"></li></ul></div><template id="template-file"><li><a href="#"></a></li></template><template id="template-folder"><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div><button class="folder-button"><span class="folder-title"></span></button></div></div><div class="folder-outer"><ul class="content"></ul></div></li></template></div></div><div class="center"><div class="page-header"><div class="popover-hint"><nav class="breadcrumb-container" aria-label="breadcrumbs"><div class="breadcrumb-element"><a href="../../../">Home</a><p> ❯ </p></div><div class="breadcrumb-element"><a href="../../../developer-guide/">developer guide</a><p> ❯ </p></div><div class="breadcrumb-element"><a href="../../../developer-guide/technical-reference/">technical reference</a><p> ❯ </p></div><div class="breadcrumb-element"><a href="../../../developer-guide/technical-reference/flows/">flows</a><p> ❯ </p></div><div class="breadcrumb-element"><a href>Equipment Management End to End Flow</a></div></nav><h1 class="article-title">Equipment Management End to End Flow</h1><p show-comma="true" class="content-meta"><time datetime="2025-11-01T20:49:23.000Z">Nov 01, 2025</time><span>32 min read</span></p><ul class="tags"><li><a href="../../../tags/flow" class="internal tag-link">flow</a></li><li><a href="../../../tags/architecture" class="internal tag-link">architecture</a></li><li><a href="../../../tags/system" class="internal tag-link">system</a></li><li><a href="../../../tags/equipment" class="internal tag-link">equipment</a></li><li><a href="../../../tags/bow-setup" class="internal tag-link">bow-setup</a></li><li><a href="../../../tags/statistics" class="internal tag-link">statistics</a></li><li><a href="../../../tags/end-to-end" class="internal tag-link">end-to-end</a></li><li><a href="../../../tags/diagrams" class="internal tag-link">diagrams</a></li></ul></div></div><article class="popover-hint"><p><a href="../../../" class="internal alias" data-slug="index">Home</a> > <a href="../../../Technical-Reference/" class="internal alias" data-slug="Technical-Reference/index">Technical Reference</a> > <a href="../../../Technical-Reference/Flows/" class="internal alias" data-slug="Technical-Reference/Flows/index">Flows</a> > <a href="../../../Technical-Reference/Flows/System-Flows/" class="internal alias" data-slug="Technical-Reference/Flows/System-Flows/index">System Flows</a> > Equipment Management: End-to-End Flow</p>
<hr/>
<h1 id="equipment-management-end-to-end-flow">Equipment Management: End-to-End Flow<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#equipment-management-end-to-end-flow" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h1>
<p><strong>Tags:</strong> <a href="../../.././../../tags/equipment" class="tag-link internal alias" data-slug="tags/equipment">equipment</a> <a href="../../.././../../tags/flow" class="tag-link internal alias" data-slug="tags/flow">flow</a> <a href="../../.././../../tags/bow-setup" class="tag-link internal alias" data-slug="tags/bow-setup">bow-setup</a> <a href="../../.././../../tags/statistics" class="tag-link internal alias" data-slug="tags/statistics">statistics</a> <a href="../../.././../../tags/end-to-end" class="tag-link internal alias" data-slug="tags/end-to-end">end-to-end</a> <a href="../../.././../../tags/architecture" class="tag-link internal alias" data-slug="tags/architecture">architecture</a> <a href="../../.././../../tags/diagrams" class="tag-link internal alias" data-slug="tags/diagrams">diagrams</a>
<strong>Status:</strong> ✅ <strong>ACTIVE</strong> | Complete documentation of equipment management system
<strong>Last Updated:</strong> October 13, 2025</p>
<p><strong>Related Documentation:</strong></p>
<ul>
<li><a href="../../../Equipment-ViewModels" class="internal" data-slug="Equipment-ViewModels">Equipment-ViewModels</a> - ViewModel architecture</li>
<li><a href="../../../Equipment-Statistics" class="internal" data-slug="Equipment-Statistics">Equipment-Statistics</a> - Performance tracking</li>
<li><a href="../../../Equipment-Repositories" class="internal" data-slug="Equipment-Repositories">Equipment-Repositories</a> - Repository layer (referenced)</li>
<li><a href="../../../Round-Lifecycle-Flow" class="internal" data-slug="Round-Lifecycle-Flow">Round-Lifecycle-Flow</a> - How equipment integrates with scoring</li>
<li><a href="../../../MVVM-Patterns" class="internal" data-slug="MVVM-Patterns">MVVM-Patterns</a> - Architecture patterns used</li>
</ul>
<hr/>
<h2 id="overview">Overview<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#overview" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>The Equipment Management system provides comprehensive tracking of archery equipment including bow setups, component management, equipment selection for rounds, and performance statistics aggregation. The system supports single-user equipment, guest equipment (multi-participant rounds), equipment versioning, and detailed statistics tracking per equipment configuration.</p>
<p><strong>Key Capabilities:</strong></p>
<ul>
<li>Create and manage complete bow setups with multiple components</li>
<li>Track 10+ equipment types (riser, limbs, sight, stabilizer, arrows, etc.)</li>
<li>Associate equipment with scoring rounds</li>
<li>Track performance statistics per equipment configuration</li>
<li>Version equipment setups to track changes over time</li>
<li>Auto-generate guest setups for multi-participant rounds</li>
<li>Advanced statistics including grouping analysis and fatigue detection</li>
</ul>
<hr/>
<h2 id="architecture-layers">Architecture Layers<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#architecture-layers" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="system-architecture-overview">System Architecture Overview<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#system-architecture-overview" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<pre><button class="expand-button" aria-label="Expand mermaid diagram" data-view-component="true"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path fill-rule="evenodd" d="M3.72 3.72a.75.75 0 011.06 1.06L2.56 7h10.88l-2.22-2.22a.75.75 0 011.06-1.06l3.5 3.5a.75.75 0 010 1.06l-3.5 3.5a.75.75 0 11-1.06-1.06l2.22-2.22H2.56l2.22 2.22a.75.75 0 11-1.06 1.06l-3.5-3.5a.75.75 0 010-1.06l3.5-3.5z"></path></svg></button><code class="mermaid" data-clipboard="&quot;graph TB\n    subgraph \&quot;UI Layer\&quot;\n        UI[Equipment Screens&lt;br/>BowSetupDetailScreen&lt;br/>EquipmentManagementScreen&lt;br/>Component Detail Screens]\n    end\n    \n    subgraph \&quot;ViewModel Layer\&quot;\n        VM[ViewModels&lt;br/>BowSetupViewModel&lt;br/>Component ViewModels&lt;br/>StateFlow Management]\n    end\n    \n    subgraph \&quot;Repository Layer\&quot;\n        REPO[BowSetupRepository&lt;br/>Coordinates DAOs&lt;br/>Business Logic]\n    end\n    \n    subgraph \&quot;Database Layer\&quot;\n        DAO[DAOs&lt;br/>BowSetupDao&lt;br/>EquipmentStatsDao&lt;br/>Component DAOs]\n        DB[(Room Database&lt;br/>Equipment Tables&lt;br/>Stats Cache)]\n    end\n    \n    subgraph \&quot;Data Models\&quot;\n        MODELS[Entities&lt;br/>BowSetup&lt;br/>Equipment Components&lt;br/>Statistics Models]\n    end\n    \n    UI -->|User Actions| VM\n    VM -->|State Updates| UI\n    VM -->|Data Operations| REPO\n    REPO -->|CRUD Operations| DAO\n    DAO -->|SQL Queries| DB\n    DB -->|Results| DAO\n    REPO -->|Entity Mapping| MODELS\n    \n    style UI fill:#e1f5ff\n    style VM fill:#fff4e1\n    style REPO fill:#e8f5e9\n    style DAO fill:#f3e5f5\n    style DB fill:#ffebee\n    style MODELS fill:#fce4ec&quot;">graph TB
    subgraph &quot;UI Layer&quot;
        UI[Equipment Screens&lt;br/>BowSetupDetailScreen&lt;br/>EquipmentManagementScreen&lt;br/>Component Detail Screens]
    end
    
    subgraph &quot;ViewModel Layer&quot;
        VM[ViewModels&lt;br/>BowSetupViewModel&lt;br/>Component ViewModels&lt;br/>StateFlow Management]
    end
    
    subgraph &quot;Repository Layer&quot;
        REPO[BowSetupRepository&lt;br/>Coordinates DAOs&lt;br/>Business Logic]
    end
    
    subgraph &quot;Database Layer&quot;
        DAO[DAOs&lt;br/>BowSetupDao&lt;br/>EquipmentStatsDao&lt;br/>Component DAOs]
        DB[(Room Database&lt;br/>Equipment Tables&lt;br/>Stats Cache)]
    end
    
    subgraph &quot;Data Models&quot;
        MODELS[Entities&lt;br/>BowSetup&lt;br/>Equipment Components&lt;br/>Statistics Models]
    end
    
    UI -->|User Actions| VM
    VM -->|State Updates| UI
    VM -->|Data Operations| REPO
    REPO -->|CRUD Operations| DAO
    DAO -->|SQL Queries| DB
    DB -->|Results| DAO
    REPO -->|Entity Mapping| MODELS
    
    style UI fill:#e1f5ff
    style VM fill:#fff4e1
    style REPO fill:#e8f5e9
    style DAO fill:#f3e5f5
    style DB fill:#ffebee
    style MODELS fill:#fce4ec
</code><div id="mermaid-container" role="dialog"><div id="mermaid-space"><div class="mermaid-content"></div></div></div></pre>
<h3 id="layer-interaction-flow">Layer Interaction Flow<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#layer-interaction-flow" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<pre><button class="expand-button" aria-label="Expand mermaid diagram" data-view-component="true"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path fill-rule="evenodd" d="M3.72 3.72a.75.75 0 011.06 1.06L2.56 7h10.88l-2.22-2.22a.75.75 0 011.06-1.06l3.5 3.5a.75.75 0 010 1.06l-3.5 3.5a.75.75 0 11-1.06-1.06l2.22-2.22H2.56l2.22 2.22a.75.75 0 11-1.06 1.06l-3.5-3.5a.75.75 0 010-1.06l3.5-3.5z"></path></svg></button><code class="mermaid" data-clipboard="&quot;sequenceDiagram\n    participant User\n    participant UI as UI Layer\n    participant VM as ViewModel\n    participant Repo as Repository\n    participant DAO as DAO\n    participant DB as Database\n    \n    User->>UI: Click \&quot;Save Setup\&quot;\n    UI->>VM: saveBowSetup()\n    VM->>VM: Validate Input\n    VM->>Repo: insertBowSetup(bowSetup)\n    Repo->>DAO: insertBowSetup()\n    DAO->>DB: INSERT INTO bow_setup\n    DB-->>DAO: Return ID\n    DAO-->>Repo: Setup ID\n    Repo->>DAO: insertBowSetupEquipment()\n    DAO->>DB: INSERT INTO bow_setup_equipment\n    DB-->>DAO: Success\n    DAO-->>Repo: Success\n    Repo-->>VM: SaveResult.Success\n    VM->>VM: Update StateFlow\n    VM-->>UI: State Change\n    UI-->>User: Show Success Message&quot;">sequenceDiagram
    participant User
    participant UI as UI Layer
    participant VM as ViewModel
    participant Repo as Repository
    participant DAO as DAO
    participant DB as Database
    
    User->>UI: Click &quot;Save Setup&quot;
    UI->>VM: saveBowSetup()
    VM->>VM: Validate Input
    VM->>Repo: insertBowSetup(bowSetup)
    Repo->>DAO: insertBowSetup()
    DAO->>DB: INSERT INTO bow_setup
    DB-->>DAO: Return ID
    DAO-->>Repo: Setup ID
    Repo->>DAO: insertBowSetupEquipment()
    DAO->>DB: INSERT INTO bow_setup_equipment
    DB-->>DAO: Success
    DAO-->>Repo: Success
    Repo-->>VM: SaveResult.Success
    VM->>VM: Update StateFlow
    VM-->>UI: State Change
    UI-->>User: Show Success Message
</code><div id="mermaid-container" role="dialog"><div id="mermaid-space"><div class="mermaid-content"></div></div></div></pre>
<hr/>
<h3 id="1-data-models">1. Data Models<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#1-data-models" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><strong>Location:</strong> <code>app/src/main/java/com/archeryapprentice/data/models/equipment/</code></p>
<h4 id="core-equipment-container">Core Equipment Container<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#core-equipment-container" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p><strong>BowSetup</strong> (BowSetup.kt:18-52)</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="kotlin" data-theme="github-light github-dark"><code data-language="kotlin" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@Entity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tableName </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;bow_setup&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BowSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @PrimaryKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(autoGenerate </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> id: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> name: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> version: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Equipment version tracking</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> notes: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> createdAt: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Date</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> updatedAt: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Date</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> isActive: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Boolean</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,            </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Soft deletion</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> isDefault: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Boolean</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,          </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Default setup flag</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Guest setup support for multi-participant rounds</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> isGuestSetup: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Boolean</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,       </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Auto-generated for guests</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> parentParticipantId: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">? </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Links to SessionParticipant.id</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sourceRoundId: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">? </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">           // Round where guest setup was created</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></figure>
<p><strong>Key Methods:</strong></p>
<ul>
<li><code>isSelectableByMainUser()</code> - Filters out guest setups from user selection</li>
<li><code>getDisplayName()</code> - UI-friendly name with guest/default indicators</li>
<li><code>isAutoGenerated()</code> - Identifies system-generated setups</li>
</ul>
<h4 id="equipment-components-17-types">Equipment Components (17 Types)<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#equipment-components-17-types" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p><strong>Individual Components:</strong></p>
<ol>
<li><strong>Riser</strong> - Bow handle/grip (Riser.kt)</li>
<li><strong>Limbs</strong> - Bow limbs (Limbs.kt) with LimbLength enum</li>
<li><strong>Sight</strong> - Aiming sight (Sight.kt) with SightMarks</li>
<li><strong>Arrow</strong> - Arrow shaft (Arrow.kt) with ArrowPoint and ArrowNock</li>
<li><strong>BowString</strong> - Bow string (BowString.kt)</li>
<li><strong>Plunger</strong> - Button plunger (Plunger.kt)</li>
<li><strong>Rest</strong> - Arrow rest (Rest.kt)</li>
<li><strong>Stabilizer</strong> - Bow stabilizer (Stabilizer.kt) - <strong>Multi-item</strong></li>
<li><strong>Weight</strong> - Balance weights (Weight.kt) - <strong>Multi-item</strong></li>
<li><strong>Accessory</strong> - General accessories (Accessory.kt) - <strong>Multi-item</strong></li>
</ol>
<p><strong>Equipment Junction Table:</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="kotlin" data-theme="github-light github-dark"><code data-language="kotlin" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@Entity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tableName </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;bow_setup_equipment&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BowSetupEquipment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @PrimaryKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(autoGenerate </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> id: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> setupId: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                       </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// FK to BowSetup</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> equipmentType: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">EquipmentType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,        </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Type enum</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> equipmentId: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// FK to specific equipment</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> quantity: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// For multi-item types</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> addedAt: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Date</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></figure>
<p><strong>Composite View Model:</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="kotlin" data-theme="github-light github-dark"><code data-language="kotlin" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BowSetupWithEquipment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> setup: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BowSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> riser: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Riser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">? </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> limbs: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Limbs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">? </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sight: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Sight</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">? </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> stabilizers: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">List</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Stabilizer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">> </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> emptyList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Multi-item</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> plunger: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Plunger</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">? </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rest: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Rest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">? </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bowString: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BowString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">? </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> arrow: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Arrow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">? </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> weights: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">List</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Weight</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">> </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> emptyList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),          </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Multi-item</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> accessories: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">List</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Accessory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">> </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> emptyList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Multi-item</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></figure>
<h4 id="equipment-statistics-models">Equipment Statistics Models<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#equipment-statistics-models" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p><strong>Location:</strong> <code>app/src/main/java/com/archeryapprentice/data/models/EquipmentStatsModels.kt</code></p>
<p><strong>Core Performance Metrics</strong> (EquipmentStatsModels.kt:39-54)</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="kotlin" data-theme="github-light github-dark"><code data-language="kotlin" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> EquipmentPerformanceStats</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bowSetupId: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> totalArrows: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> averageScore: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Double</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> xCount: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tenCount: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nineOrBetterCount: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> missCount: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> firstShotAt: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lastShotAt: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> roundCount: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Int</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> accuracy: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Double</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // (tenCount / totalArrows) * 100</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> consistency: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Double</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     // (nineOrBetterCount / totalArrows) * 100</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> missRate: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Double</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // (missCount / totalArrows) * 100</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></figure>
<p><strong>Advanced Analytics</strong> (EquipmentStatsModels.kt:94-150)</p>
<ul>
<li><strong>AdvancedShotGrouping</strong> - Grouping analysis with eccentricity, bias detection</li>
<li><strong>FatigueMetrics</strong> - Performance decline analysis</li>
<li><strong>ConsistencyMetrics</strong> - End-to-end consistency tracking</li>
<li><strong>EquipmentDistancePerformance</strong> - Distance-specific stats</li>
<li><strong>ComparativeEquipmentStats</strong> - Cross-equipment comparison</li>
</ul>
<p><strong>Snapshot for Historical Tracking:</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="kotlin" data-theme="github-light github-dark"><code data-language="kotlin" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@Entity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tableName </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;arrow_equipment_snapshot&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ArrowEquipmentSnapshot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @PrimaryKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(autoGenerate </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> id: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> arrowScoreId: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// FK to ArrowScore</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bowSetupId: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Equipment used for this arrow</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bowSetupVersion: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Version tracking</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> riserId: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">? </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,               </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Component snapshots</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> limbsId: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">? </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ... all component IDs</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> capturedAt: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> System.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">currentTimeMillis</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></figure>
<hr/>
<h3 id="2-database-layer">2. Database Layer<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#2-database-layer" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><strong>Location:</strong> <code>app/src/main/java/com/archeryapprentice/data/dao/</code></p>
<h4 id="bowsetupdao-bowsetupdaokt15-115">BowSetupDao (BowSetupDao.kt:15-115)<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#bowsetupdao-bowsetupdaokt15-115" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p><strong>CRUD Operations:</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="kotlin" data-theme="github-light github-dark"><code data-language="kotlin" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@Dao</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BowSetupDao</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Basic operations</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @Insert</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> suspend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> insertBowSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(bowSetup: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BowSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">): </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @Update</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> suspend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> updateBowSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(bowSetup: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BowSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @Delete</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> suspend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> deleteBowSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(bowSetup: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BowSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @Query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;UPDATE bow_setup SET isActive = 0 WHERE id = :id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    suspend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> softDeleteBowSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Retrieval queries</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @Query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SELECT * FROM bow_setup WHERE isActive = 1 ORDER BY updatedAt DESC&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getAllActiveBowSetups</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(): </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Flow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">List</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BowSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">>></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @Query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SELECT * FROM bow_setup WHERE id = :id AND isActive = 1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    suspend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getBowSetupById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">): </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BowSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">?</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @Query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SELECT * FROM bow_setup WHERE isDefault = 1 AND isActive = 1 LIMIT 1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    suspend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getDefaultBowSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(): </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BowSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">?</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Guest setup queries (Lines 75-114)</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @Query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SELECT * FROM bow_setup WHERE isGuestSetup = 1 </span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            AND parentParticipantId = :participantId </span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            AND sourceRoundId = :roundId AND isActive = 1 LIMIT 1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    suspend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getGuestSetupForParticipant</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(participantId: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, roundId: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">): </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BowSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">?</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @Query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SELECT * FROM bow_setup WHERE isActive = 1 AND isGuestSetup = 0 </span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            ORDER BY isDefault DESC, updatedAt DESC&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getSelectableBowSetups</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(): </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Flow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">List</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BowSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">>></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></figure>
<p><strong>Equipment Junction Operations:</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="kotlin" data-theme="github-light github-dark"><code data-language="kotlin" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// BowSetupEquipment CRUD</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@Insert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(onConflict </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> OnConflictStrategy.REPLACE)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">suspend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> insertBowSetupEquipment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(bowSetupEquipment: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BowSetupEquipment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@Query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;DELETE FROM bow_setup_equipment WHERE setupId = :setupId AND equipmentType = :equipmentType&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">suspend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> deleteEquipmentByType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(setupId: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, equipmentType: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">EquipmentType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@Query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SELECT * FROM bow_setup_equipment WHERE setupId = :setupId&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">suspend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getEquipmentForSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(setupId: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">): </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">List</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BowSetupEquipment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<h4 id="equipmentstatsdao-equipmentstatsdaokt13-150">EquipmentStatsDao (EquipmentStatsDao.kt:13-150)<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#equipmentstatsdao-equipmentstatsdaokt13-150" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p><strong>Equipment Snapshot Operations:</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="kotlin" data-theme="github-light github-dark"><code data-language="kotlin" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@Dao</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> EquipmentStatsDao</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @Insert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(onConflict </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> OnConflictStrategy.REPLACE)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    suspend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> insertEquipmentSnapshot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(snapshot: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ArrowEquipmentSnapshot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">): </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @Query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SELECT * FROM arrow_equipment_snapshot WHERE bowSetupId = :bowSetupId </span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            AND bowSetupVersion = :version ORDER BY capturedAt DESC&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    suspend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getSnapshotsForBowSetupVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(bowSetupId: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, version: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">): </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">List</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ArrowEquipmentSnapshot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></figure>
<p><strong>Equipment Usage Tracking:</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="kotlin" data-theme="github-light github-dark"><code data-language="kotlin" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@Query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SELECT DISTINCT bowSetupId, bowSetupVersion, COUNT(*) as usageCount</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        FROM arrow_equipment_snapshot </span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        WHERE capturedAt >= :startDate</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        GROUP BY bowSetupId, bowSetupVersion</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        ORDER BY usageCount DESC&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">suspend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getEquipmentUsageStats</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(startDate: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">): </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">List</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">EquipmentUsageSummary</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<p><strong>Stats Cache Management:</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="kotlin" data-theme="github-light github-dark"><code data-language="kotlin" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@Insert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(onConflict </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> OnConflictStrategy.REPLACE)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">suspend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> insertStatsCache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cache: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">EquipmentStatsCache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">): </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@Query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SELECT * FROM equipment_stats_cache </span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        WHERE cacheKey = :cacheKey AND validUntil > :currentTime&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">suspend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getValidCacheEntry</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cacheKey: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, currentTime: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">): </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">EquipmentStatsCache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">?</span></span></code></pre></figure>
<hr/>
<h3 id="3-repository-layer">3. Repository Layer<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#3-repository-layer" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><strong>Location:</strong> <code>app/src/main/java/com/archeryapprentice/domain/repository/BowSetupRepository.kt</code></p>
<h4 id="bowsetuprepository-bowsetuprepositorykt41-377">BowSetupRepository (BowSetupRepository.kt:41-377)<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#bowsetuprepository-bowsetuprepositorykt41-377" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p><strong>Initialization:</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="kotlin" data-theme="github-light github-dark"><code data-language="kotlin" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BowSetupRepository</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bowSetupDao: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BowSetupDao</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> riserDao: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">RiserDao</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> limbsDao: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">LimbsDao</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sightDao: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SightDao</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ... all component DAOs</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></figure>
<p><strong>Core Operations:</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="kotlin" data-theme="github-light github-dark"><code data-language="kotlin" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Setup retrieval</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getAllBowSetups</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(): </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Flow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">List</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BowSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">>></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getSelectableBowSetups</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(): </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Flow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">List</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BowSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">>>  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Excludes guest setups</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">suspend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getBowSetupById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">): </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BowSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">?</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">suspend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getDefaultBowSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(): </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BowSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">?</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Setup creation</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">suspend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getOrCreateDefaultBowSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(): </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BowSetup</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Lines 65-80</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">suspend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> insertBowSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(bowSetup: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BowSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">): </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">suspend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> updateBowSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(bowSetup: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BowSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">suspend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> deleteBowSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(bowSetup: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BowSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Soft delete</span></span></code></pre></figure>
<p><strong>Guest Setup Management</strong> (Lines 95-158):</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="kotlin" data-theme="github-light github-dark"><code data-language="kotlin" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * Get or create guest bow setup for participant in round</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * Ensures each guest has their own setup for statistics tracking</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">suspend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getOrCreateGuestBowSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    participant: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SessionParticipant</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    roundId: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Int</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">): </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BowSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Check if guest setup exists</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> existingSetup </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bowSetupDao.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getGuestSetupForParticipant</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(participant.id, roundId)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (existingSetup </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> existingSetup</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Create new guest setup</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> guestSetup </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BowSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Guest Setup - ${participant.displayName}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        notes </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Auto-generated for guest participant&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        isGuestSetup </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        parentParticipantId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> participant.id,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        sourceRoundId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> roundId,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        isActive </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> newId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> insertBowSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(guestSetup)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getBowSetupById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(newId) ?: guestSetup.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">copy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> newId)</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Guest cleanup</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">suspend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> cleanupGuestSetupsForRound</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(roundId: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">suspend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getGuestSetupStats</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(): </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GuestSetupStats</span></span></code></pre></figure>
<p><strong>Equipment Management</strong> (Lines 219-257):</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="kotlin" data-theme="github-light github-dark"><code data-language="kotlin" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">suspend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> addEquipmentToSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    setupId: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    equipmentType: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">EquipmentType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    equipmentId: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    quantity: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Single-item types: Remove existing first</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isSingleItemEquipment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(equipmentType)) {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        bowSetupDao.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">deleteEquipmentByType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(setupId, equipmentType)</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Insert new equipment</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bowSetupEquipment </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BowSetupEquipment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        setupId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> setupId,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        equipmentType </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> equipmentType,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        equipmentId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> equipmentId,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        quantity </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> quantity</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    bowSetupDao.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">insertBowSetupEquipment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(bowSetupEquipment)</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Update timestamp</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    getBowSetupById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(setupId)?.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { setup </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-></span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        updateBowSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(setup.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">copy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(updatedAt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()))</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">suspend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> removeEquipmentFromSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(setupId: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, equipmentType: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">EquipmentType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, equipmentId: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">suspend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getEquipmentForSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(setupId: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">): </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">List</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BowSetupEquipment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<p><strong>Complete Setup Assembly</strong> (Lines 260-312):</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="kotlin" data-theme="github-light github-dark"><code data-language="kotlin" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">suspend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getBowSetupWithEquipment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(setupId: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">): </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BowSetupWithEquipment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">? {</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> setup </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getBowSetupById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(setupId) ?: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> equipmentList </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getEquipmentForSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(setupId)</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Fetch all components by type</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> riserEquipment </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> equipmentList.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">find</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { it.equipmentType </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EquipmentType.RISER }</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> riser </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> riserEquipment?.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { riserDao.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getRiserById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(it.equipmentId) }</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> limbsEquipment </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> equipmentList.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">find</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { it.equipmentType </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EquipmentType.LIMBS }</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> limbs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> limbsEquipment?.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { limbsDao.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getLimbsById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(it.equipmentId) }</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ... fetch all other components</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Multi-item equipment</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> stabilizerEquipment </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> equipmentList.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { it.equipmentType </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EquipmentType.STABILIZER }</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> stabilizers </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> stabilizerEquipment.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mapNotNull</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        stabilizerDao.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getStabilizerById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(it.equipmentId)</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BowSetupWithEquipment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        setup </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> setup,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        riser </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> riser,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        limbs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> limbs,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        sight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sight,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        stabilizers </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> stabilizers,</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ... all components</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></figure>
<p><strong>Versioning Support</strong> (Lines 315-348):</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="kotlin" data-theme="github-light github-dark"><code data-language="kotlin" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">suspend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createNewVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(originalSetupId: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, newName: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">? </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">): </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">? {</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> originalSetup </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getBowSetupById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(originalSetupId) ?: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> originalEquipment </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getEquipmentForSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(originalSetupId)</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Increment version</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nextVersion </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> originalSetup.version </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Create new setup version</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> newSetup </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> originalSetup.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">copy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Auto-generate new ID</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> newName ?: originalSetup.name,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        version </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nextVersion,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        createdAt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        updatedAt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> newSetupId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> insertBowSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(newSetup)</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Copy all equipment to new version</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> newEquipmentList </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> originalEquipment.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        it.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">copy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(setupId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> newSetupId, addedAt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    bowSetupDao.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">insertBowSetupEquipmentList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(newEquipmentList)</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> newSetupId</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></figure>
<hr/>
<h3 id="4-viewmodel-layer">4. ViewModel Layer<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#4-viewmodel-layer" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><strong>Location:</strong> <code>app/src/main/java/com/archeryapprentice/ui/equipment/viewModels/</code></p>
<h4 id="architecture-pattern">Architecture Pattern<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#architecture-pattern" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>All equipment ViewModels follow consistent pattern:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="kotlin" data-theme="github-light github-dark"><code data-language="kotlin" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ComponentViewModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> repository: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ComponentRepository</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) : </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ViewModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 1. Observable state for list</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _items </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MutableStateFlow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">List</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Component</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">>>(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">emptyList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> items: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">StateFlow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">List</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Component</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">>> </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _items.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">asStateFlow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 2. Input state for forms</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _inputState </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MutableStateFlow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ComponentInputState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> inputState: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">StateFlow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ComponentInputState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">> </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _inputState.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">asStateFlow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 3. CRUD operations</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    init</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">loadItems</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() }</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    suspend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> saveComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(): </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SaveResult</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> deleteComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(component: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Component</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> loadComponentForEdit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> clearInputs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 4. Field update methods</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> updateBrand</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        _inputState.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _inputState.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">copy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(brand </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></figure>
<p><strong>See:</strong> <a href="../../../Equipment-ViewModels" class="internal" data-slug="Equipment-ViewModels">Equipment-ViewModels</a> for complete ViewModel documentation including:</p>
<ul>
<li>ArrowViewModel, StabilizerViewModel, SightViewModel, etc. (10 component ViewModels)</li>
<li>BowSetupViewModel (coordinates complete setup)</li>
<li>EquipmentListViewModel (inventory management)</li>
</ul>
<p><strong>Key Patterns:</strong></p>
<ul>
<li><strong>StateFlow</strong>: Reactive state management</li>
<li><strong>SaveResult</strong>: Consistent error handling</li>
<li><strong>InputState</strong>: Immutable form state</li>
<li><strong>Field Updates</strong>: Granular, type-safe updates</li>
</ul>
<hr/>
<h3 id="5-ui-layer">5. UI Layer<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#5-ui-layer" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><strong>Location:</strong> <code>app/src/main/java/com/archeryapprentice/ui/equipment/pages/</code></p>
<h4 id="main-equipment-screens">Main Equipment Screens<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#main-equipment-screens" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p><strong>EquipmentManagementScreen.kt</strong></p>
<ul>
<li>Entry point for equipment management</li>
<li>Navigation hub to all equipment types</li>
<li>Equipment type selection</li>
</ul>
<p><strong>SelectEquipmentTypeScreen.kt</strong></p>
<ul>
<li>Grid/list view of equipment types</li>
<li>Quick navigation to component entry</li>
<li>Search and filter capabilities</li>
</ul>
<p><strong>BowSetupDetailScreen.kt</strong> (equipment/)</p>
<ul>
<li>Complete bow setup creation/editing</li>
<li>Component selection for each type</li>
<li>Equipment assembly and validation</li>
<li>Performance statistics display (tabs)</li>
</ul>
<h4 id="component-detail-screens-equipmentdetailpages">Component Detail Screens (equipment/detailpages/)<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#component-detail-screens-equipmentdetailpages" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>Individual screens for each equipment type:</p>
<ul>
<li>ArrowDetailScreen.kt</li>
<li>RiserDetailScreen.kt</li>
<li>LimbsDetailScreen.kt</li>
<li>SightDetailScreen.kt</li>
<li>StabilizerDetailScreen.kt</li>
<li>BowStringDetailScreen.kt</li>
<li>PlungerDetailScreen.kt</li>
<li>RestDetailScreen.kt</li>
<li>WeightDetailScreen.kt</li>
<li>AccessoryDetailScreen.kt</li>
</ul>
<p><strong>Pattern</strong>: All follow same layout:</p>
<ol>
<li>Input form with validation</li>
<li>Equipment list display</li>
<li>Edit/delete actions</li>
<li>Save/cancel buttons</li>
</ol>
<h4 id="equipment-analytics-screens-equipmentanalytics">Equipment Analytics Screens (equipment/analytics/)<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#equipment-analytics-screens-equipmentanalytics" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p><strong>EquipmentAnalyticsHubScreen.kt</strong></p>
<ul>
<li>Central analytics dashboard</li>
<li>Performance overview</li>
<li>Navigation to detailed views</li>
</ul>
<p><strong>EquipmentComparisonScreen.kt</strong></p>
<ul>
<li>Side-by-side equipment comparison</li>
<li>Performance metrics comparison</li>
<li>Chart visualizations</li>
</ul>
<p><strong>EquipmentExportScreen.kt</strong></p>
<ul>
<li>Export equipment data</li>
<li>Statistics export</li>
<li>Share functionality</li>
</ul>
<h4 id="performance-statistics-tab">Performance Statistics Tab<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#performance-statistics-tab" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p><strong>BowSetupPerformanceTab</strong> (component in BowSetupDetailScreen)</p>
<ul>
<li>Accuracy percentage by equipment</li>
<li>Average score per arrow</li>
<li>X count and 10 count</li>
<li>Rounds completed with equipment</li>
<li>Distance-specific performance</li>
<li>Advanced grouping analysis</li>
<li>Fatigue detection</li>
<li>Consistency metrics</li>
</ul>
<hr/>
<h2 id="user-journeys">User Journeys<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#user-journeys" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="journey-1-create-new-bow-setup">Journey 1: Create New Bow Setup<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#journey-1-create-new-bow-setup" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><strong>Flow:</strong> Equipment Hub → New Setup → Add Components → Save</p>
<pre><button class="expand-button" aria-label="Expand mermaid diagram" data-view-component="true"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path fill-rule="evenodd" d="M3.72 3.72a.75.75 0 011.06 1.06L2.56 7h10.88l-2.22-2.22a.75.75 0 011.06-1.06l3.5 3.5a.75.75 0 010 1.06l-3.5 3.5a.75.75 0 11-1.06-1.06l2.22-2.22H2.56l2.22 2.22a.75.75 0 11-1.06 1.06l-3.5-3.5a.75.75 0 010-1.06l3.5-3.5z"></path></svg></button><code class="mermaid" data-clipboard="&quot;flowchart TD\n    Start([User clicks Equipment]) --> Hub[EquipmentManagementScreen]\n    Hub --> NewSetup[Click New Bow Setup]\n    NewSetup --> DetailScreen[BowSetupDetailScreen&lt;br/>Create Mode]\n    DetailScreen --> EnterName[Enter Setup Name&lt;br/>updateName]\n    \n    EnterName --> SelectComponents{Select Components}\n    \n    SelectComponents -->|For each type| SelectRiser[Select Riser&lt;br/>updateRiserId]\n    SelectComponents -->|For each type| SelectLimbs[Select Limbs&lt;br/>updateLimbsId]\n    SelectComponents -->|For each type| SelectSight[Select Sight&lt;br/>updateSightId]\n    SelectComponents -->|For each type| SelectArrow[Select Arrow&lt;br/>updateArrowId]\n    SelectComponents -->|Multi-item| SelectStabs[Select Stabilizers&lt;br/>updateStabilizerIds]\n    \n    SelectRiser --> ComponentsReady{All Components&lt;br/>Selected?}\n    SelectLimbs --> ComponentsReady\n    SelectSight --> ComponentsReady\n    SelectArrow --> ComponentsReady\n    SelectStabs --> ComponentsReady\n    \n    ComponentsReady -->|Yes| ClickSave[Click Save Button]\n    ComponentsReady -->|No| SelectComponents\n    \n    ClickSave --> VMSave[BowSetupViewModel&lt;br/>saveBowSetup]\n    VMSave --> Validate{Validate&lt;br/>Input?}\n    \n    Validate -->|Invalid| ShowError[Show Validation&lt;br/>Error]\n    ShowError --> DetailScreen\n    \n    Validate -->|Valid| RepoInsert[BowSetupRepository&lt;br/>insertBowSetup]\n    RepoInsert --> DAOInsert[BowSetupDao&lt;br/>insertBowSetup]\n    DAOInsert --> DBInsert[(Database&lt;br/>INSERT bow_setup)]\n    \n    DBInsert --> ReturnID[Return Setup ID]\n    ReturnID --> AddEquipment[For Each Component&lt;br/>addEquipmentToSetup]\n    AddEquipment --> JunctionInsert[(Database&lt;br/>INSERT bow_setup_equipment)]\n    \n    JunctionInsert --> UpdateTimestamp[Update Timestamp&lt;br/>updatedAt = now]\n    UpdateTimestamp --> Success[SaveResult.Success]\n    Success --> ClearInputs[clearInputs]\n    ClearInputs --> RefreshList[loadBowSetups]\n    RefreshList --> Navigate[Navigate to List]\n    Navigate --> End([Setup Created])\n    \n    style Start fill:#e1f5ff\n    style End fill:#c8e6c9\n    style ShowError fill:#ffcdd2\n    style Success fill:#c8e6c9&quot;">flowchart TD
    Start([User clicks Equipment]) --> Hub[EquipmentManagementScreen]
    Hub --> NewSetup[Click New Bow Setup]
    NewSetup --> DetailScreen[BowSetupDetailScreen&lt;br/>Create Mode]
    DetailScreen --> EnterName[Enter Setup Name&lt;br/>updateName]
    
    EnterName --> SelectComponents{Select Components}
    
    SelectComponents -->|For each type| SelectRiser[Select Riser&lt;br/>updateRiserId]
    SelectComponents -->|For each type| SelectLimbs[Select Limbs&lt;br/>updateLimbsId]
    SelectComponents -->|For each type| SelectSight[Select Sight&lt;br/>updateSightId]
    SelectComponents -->|For each type| SelectArrow[Select Arrow&lt;br/>updateArrowId]
    SelectComponents -->|Multi-item| SelectStabs[Select Stabilizers&lt;br/>updateStabilizerIds]
    
    SelectRiser --> ComponentsReady{All Components&lt;br/>Selected?}
    SelectLimbs --> ComponentsReady
    SelectSight --> ComponentsReady
    SelectArrow --> ComponentsReady
    SelectStabs --> ComponentsReady
    
    ComponentsReady -->|Yes| ClickSave[Click Save Button]
    ComponentsReady -->|No| SelectComponents
    
    ClickSave --> VMSave[BowSetupViewModel&lt;br/>saveBowSetup]
    VMSave --> Validate{Validate&lt;br/>Input?}
    
    Validate -->|Invalid| ShowError[Show Validation&lt;br/>Error]
    ShowError --> DetailScreen
    
    Validate -->|Valid| RepoInsert[BowSetupRepository&lt;br/>insertBowSetup]
    RepoInsert --> DAOInsert[BowSetupDao&lt;br/>insertBowSetup]
    DAOInsert --> DBInsert[(Database&lt;br/>INSERT bow_setup)]
    
    DBInsert --> ReturnID[Return Setup ID]
    ReturnID --> AddEquipment[For Each Component&lt;br/>addEquipmentToSetup]
    AddEquipment --> JunctionInsert[(Database&lt;br/>INSERT bow_setup_equipment)]
    
    JunctionInsert --> UpdateTimestamp[Update Timestamp&lt;br/>updatedAt = now]
    UpdateTimestamp --> Success[SaveResult.Success]
    Success --> ClearInputs[clearInputs]
    ClearInputs --> RefreshList[loadBowSetups]
    RefreshList --> Navigate[Navigate to List]
    Navigate --> End([Setup Created])
    
    style Start fill:#e1f5ff
    style End fill:#c8e6c9
    style ShowError fill:#ffcdd2
    style Success fill:#c8e6c9
</code><div id="mermaid-container" role="dialog"><div id="mermaid-space"><div class="mermaid-content"></div></div></div></pre>
<p><strong>1. Navigate to Equipment</strong> (EquipmentManagementScreen)</p>
<pre><code>User clicks &quot;Equipment&quot; in bottom nav
→ EquipmentManagementScreen displays
→ Shows equipment type options
</code></pre>
<p><strong>2. Create New Setup</strong> (BowSetupDetailScreen)</p>
<pre><code>User clicks &quot;New Bow Setup&quot;
→ BowSetupDetailScreen displays in create mode
→ BowSetupViewModel initializes empty InputState
   - Location: BowSetupViewModel.kt:init
   - Sets isEditing = false, editingId = 0
</code></pre>
<p><strong>3. Enter Setup Details</strong></p>
<pre><code>User enters setup name: &quot;Competition Setup&quot;
→ BowSetupViewModel.updateName(&quot;Competition Setup&quot;)
   - Location: BowSetupViewModel.kt:updateName()
   - Updates inputState.name via StateFlow
</code></pre>
<p><strong>4. Add Components</strong> (Per Component Type)</p>
<pre><code>User clicks &quot;Select Riser&quot;
→ Navigation to RiserDetailScreen
→ User selects riser from list
→ BowSetupViewModel.updateRiserId(selectedRiser.id)
   - Location: BowSetupViewModel.kt:updateRiserId()
   
Repeat for:
- Limbs (updateLimbsId)
- Sight (updateSightId)
- Arrows (updateArrowId)
- String (updateStringId)
- Plunger (updatePlungerId)
- Rest (updateRestId)
- Stabilizers (updateStabilizerIds) - Multi-item
- Weights (updateWeightIds) - Multi-item
</code></pre>
<p><strong>5. Save Setup</strong></p>
<pre><code>User clicks &quot;Save&quot;
→ BowSetupViewModel.saveBowSetup()
   - Location: BowSetupViewModel.kt:saveBowSetup()
   - Validates inputState
   - Creates BowSetup entity
   - Calls BowSetupRepository.insertBowSetup()
   
Repository Flow:
→ BowSetupRepository.insertBowSetup(bowSetup)
   - Location: BowSetupRepository.kt:82
   - bowSetupDao.insertBowSetup(bowSetup) returns ID
   
→ For each component:
   - BowSetupRepository.addEquipmentToSetup(setupId, type, componentId)
   - Location: BowSetupRepository.kt:219-237
   - Creates BowSetupEquipment junction entry
   - bowSetupDao.insertBowSetupEquipment()
   
→ Updates setup timestamp
   - getBowSetupById(setupId)
   - updateBowSetup(setup.copy(updatedAt = Date()))
   - Location: BowSetupRepository.kt:235-236
</code></pre>
<p><strong>6. Success &amp; Navigation</strong></p>
<pre><code>SaveResult.Success returned
→ BowSetupViewModel.clearInputs()
→ BowSetupViewModel.loadBowSetups() refreshes list
→ Navigate back to equipment list
→ New setup appears in list
</code></pre>
<p><strong>File References:</strong></p>
<ul>
<li>BowSetupDetailScreen.kt - UI composition</li>
<li>BowSetupViewModel.kt - State management</li>
<li>BowSetupRepository.kt:82, 219-237 - Data operations</li>
<li>BowSetupDao.kt:19, 47 - Database operations</li>
</ul>
<hr/>
<h3 id="journey-2-select-equipment-for-round">Journey 2: Select Equipment for Round<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#journey-2-select-equipment-for-round" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><strong>Flow:</strong> Round Creation → Equipment Selection → Associate with Round</p>
<pre><button class="expand-button" aria-label="Expand mermaid diagram" data-view-component="true"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path fill-rule="evenodd" d="M3.72 3.72a.75.75 0 011.06 1.06L2.56 7h10.88l-2.22-2.22a.75.75 0 011.06-1.06l3.5 3.5a.75.75 0 010 1.06l-3.5 3.5a.75.75 0 11-1.06-1.06l2.22-2.22H2.56l2.22 2.22a.75.75 0 11-1.06 1.06l-3.5-3.5a.75.75 0 010-1.06l3.5-3.5z"></path></svg></button><code class="mermaid" data-clipboard="&quot;flowchart TD\n    Start([New Round]) --> RoundStart[RoundViewModel&lt;br/>startNewRound]\n    RoundStart --> EquipSelect[Equipment Selection&lt;br/>Screen]\n    \n    EquipSelect --> QuerySetups[BowSetupRepository&lt;br/>getSelectableBowSetups]\n    QuerySetups --> DAOQuery[BowSetupDao&lt;br/>Exclude Guest Setups]\n    DAOQuery --> DBQuery[(Database&lt;br/>WHERE isGuestSetup=0)]\n    DBQuery --> DisplayList[Display Setup List&lt;br/>Ordered by Default, Updated]\n    \n    DisplayList --> Search{User Searches?}\n    Search -->|Yes| Filter[Client-Side Filter]\n    Search -->|No| UserSelect\n    Filter --> UserSelect[User Selects Setup]\n    \n    UserSelect --> UpdateVM[RoundViewModel&lt;br/>updateSelectedBowSetup]\n    UpdateVM --> CompleteRound[User Completes Round&lt;br/>Setup]\n    CompleteRound --> CreateRound[RoundViewModel&lt;br/>createRound]\n    \n    CreateRound --> MultiCheck{Multi-Participant?}\n    \n    MultiCheck -->|No| InsertRound[RoundRepository&lt;br/>insertRound&lt;br/>with bowSetupId]\n    \n    MultiCheck -->|Yes| InsertRoundMP[RoundRepository&lt;br/>insertRound]\n    InsertRoundMP --> GuestLoop{For Each&lt;br/>Guest Participant}\n    \n    GuestLoop --> CreateGuest[BowSetupRepository&lt;br/>getOrCreateGuestBowSetup]\n    CreateGuest --> CheckExist{Guest Setup&lt;br/>Exists?}\n    \n    CheckExist -->|Yes| ReturnExisting[Return Existing&lt;br/>Guest Setup]\n    CheckExist -->|No| CreateNew[Create New&lt;br/>Guest Setup]\n    CreateNew --> InsertGuest[(Database&lt;br/>INSERT guest setup)]\n    InsertGuest --> LinkGuest[Link to participantId&lt;br/>and roundId]\n    LinkGuest --> ReturnExisting\n    \n    ReturnExisting --> MoreGuests{More Guests?}\n    MoreGuests -->|Yes| GuestLoop\n    MoreGuests -->|No| InsertRound\n    \n    InsertRound --> FirstArrow[User Shoots&lt;br/>First Arrow]\n    FirstArrow --> CreateSnapshot[Create&lt;br/>ArrowEquipmentSnapshot]\n    CreateSnapshot --> SnapshotData[Capture bowSetupId&lt;br/>bowSetupVersion&lt;br/>all component IDs]\n    SnapshotData --> InsertSnapshot[(Database&lt;br/>INSERT snapshot)]\n    InsertSnapshot --> End([Round Ready&lt;br/>Equipment Tracked])\n    \n    style Start fill:#e1f5ff\n    style End fill:#c8e6c9\n    style CreateGuest fill:#fff9c4\n    style CreateSnapshot fill:#f3e5f5&quot;">flowchart TD
    Start([New Round]) --> RoundStart[RoundViewModel&lt;br/>startNewRound]
    RoundStart --> EquipSelect[Equipment Selection&lt;br/>Screen]
    
    EquipSelect --> QuerySetups[BowSetupRepository&lt;br/>getSelectableBowSetups]
    QuerySetups --> DAOQuery[BowSetupDao&lt;br/>Exclude Guest Setups]
    DAOQuery --> DBQuery[(Database&lt;br/>WHERE isGuestSetup=0)]
    DBQuery --> DisplayList[Display Setup List&lt;br/>Ordered by Default, Updated]
    
    DisplayList --> Search{User Searches?}
    Search -->|Yes| Filter[Client-Side Filter]
    Search -->|No| UserSelect
    Filter --> UserSelect[User Selects Setup]
    
    UserSelect --> UpdateVM[RoundViewModel&lt;br/>updateSelectedBowSetup]
    UpdateVM --> CompleteRound[User Completes Round&lt;br/>Setup]
    CompleteRound --> CreateRound[RoundViewModel&lt;br/>createRound]
    
    CreateRound --> MultiCheck{Multi-Participant?}
    
    MultiCheck -->|No| InsertRound[RoundRepository&lt;br/>insertRound&lt;br/>with bowSetupId]
    
    MultiCheck -->|Yes| InsertRoundMP[RoundRepository&lt;br/>insertRound]
    InsertRoundMP --> GuestLoop{For Each&lt;br/>Guest Participant}
    
    GuestLoop --> CreateGuest[BowSetupRepository&lt;br/>getOrCreateGuestBowSetup]
    CreateGuest --> CheckExist{Guest Setup&lt;br/>Exists?}
    
    CheckExist -->|Yes| ReturnExisting[Return Existing&lt;br/>Guest Setup]
    CheckExist -->|No| CreateNew[Create New&lt;br/>Guest Setup]
    CreateNew --> InsertGuest[(Database&lt;br/>INSERT guest setup)]
    InsertGuest --> LinkGuest[Link to participantId&lt;br/>and roundId]
    LinkGuest --> ReturnExisting
    
    ReturnExisting --> MoreGuests{More Guests?}
    MoreGuests -->|Yes| GuestLoop
    MoreGuests -->|No| InsertRound
    
    InsertRound --> FirstArrow[User Shoots&lt;br/>First Arrow]
    FirstArrow --> CreateSnapshot[Create&lt;br/>ArrowEquipmentSnapshot]
    CreateSnapshot --> SnapshotData[Capture bowSetupId&lt;br/>bowSetupVersion&lt;br/>all component IDs]
    SnapshotData --> InsertSnapshot[(Database&lt;br/>INSERT snapshot)]
    InsertSnapshot --> End([Round Ready&lt;br/>Equipment Tracked])
    
    style Start fill:#e1f5ff
    style End fill:#c8e6c9
    style CreateGuest fill:#fff9c4
    style CreateSnapshot fill:#f3e5f5
</code><div id="mermaid-container" role="dialog"><div id="mermaid-space"><div class="mermaid-content"></div></div></div></pre>
<p><strong>1. Start New Round</strong> (from RoundScoringScreen)</p>
<pre><code>User clicks &quot;New Round&quot; in scoring
→ RoundViewModel.startNewRound()
   - Location: RoundViewModel.kt:startNewRound()
   - Initializes round creation state
</code></pre>
<p><strong>2. Equipment Selection Prompt</strong></p>
<pre><code>During round creation flow:
→ Equipment selection screen displays
→ BowSetupRepository.getSelectableBowSetups()
   - Location: BowSetupRepository.kt:59
   - Returns Flow&lt;List&lt;BowSetup>> excluding guest setups
   
Database Query:
→ BowSetupDao.getSelectableBowSetups()
   - Location: BowSetupDao.kt:85-91
   - Query: WHERE isActive = 1 AND isGuestSetup = 0
   - Orders by isDefault DESC, updatedAt DESC
</code></pre>
<p><strong>3. Filter/Search</strong></p>
<pre><code>User enters search: &quot;Competition&quot;
→ ViewModel filters list client-side
→ Displays matching setups only
</code></pre>
<p><strong>4. Select Setup</strong></p>
<pre><code>User selects &quot;Competition Setup&quot;
→ RoundViewModel.updateSelectedBowSetup(setupId)
   - Location: RoundViewModel.kt:updateSelectedBowSetup()
   - Stores setupId in round creation state
</code></pre>
<p><strong>5. Create Round with Equipment</strong></p>
<pre><code>User completes round setup, clicks &quot;Create Round&quot;
→ RoundViewModel.createRound()
   - Location: RoundViewModel.kt:createRound()
   - Creates Round entity with bowSetupId
   
→ RoundRepository.insertRound(round)
   - Saves round with FK to bow_setup.id
   
For Multi-Participant Rounds:
→ For each guest participant:
   - BowSetupRepository.getOrCreateGuestBowSetup(participant, roundId)
   - Location: BowSetupRepository.kt:99-127
   - Auto-creates guest setup if not exists
   - Associates with participant.id and roundId
</code></pre>
<p><strong>6. Equipment Snapshot on First Arrow</strong></p>
<pre><code>When user shoots first arrow:
→ Arrow created with ArrowScore entity
→ ArrowEquipmentSnapshot created
   - Location: During arrow save in RoundViewModel
   - Captures bowSetupId, bowSetupVersion
   - Captures all component IDs from setup
   - timestamp = System.currentTimeMillis()
   
→ EquipmentStatsDao.insertEquipmentSnapshot(snapshot)
   - Location: EquipmentStatsDao.kt:20
</code></pre>
<p><strong>File References:</strong></p>
<ul>
<li>RoundViewModel.kt - Round creation logic</li>
<li>BowSetupRepository.kt:59, 99-127 - Equipment retrieval and guest setup</li>
<li>BowSetupDao.kt:85-91 - Selectable setups query</li>
<li>EquipmentStatsDao.kt:20 - Snapshot creation</li>
</ul>
<hr/>
<h3 id="journey-3-view-equipment-statistics">Journey 3: View Equipment Statistics<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#journey-3-view-equipment-statistics" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><strong>Flow:</strong> Equipment List → Setup Detail → Performance Tab → Statistics Display</p>
<pre><button class="expand-button" aria-label="Expand mermaid diagram" data-view-component="true"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path fill-rule="evenodd" d="M3.72 3.72a.75.75 0 011.06 1.06L2.56 7h10.88l-2.22-2.22a.75.75 0 011.06-1.06l3.5 3.5a.75.75 0 010 1.06l-3.5 3.5a.75.75 0 11-1.06-1.06l2.22-2.22H2.56l2.22 2.22a.75.75 0 11-1.06 1.06l-3.5-3.5a.75.75 0 010-1.06l3.5-3.5z"></path></svg></button><code class="mermaid" data-clipboard="&quot;flowchart TD\n    Start([Navigate to&lt;br/>Equipment]) --> List[Equipment List&lt;br/>getAllBowSetups]\n    List --> Select[User Selects&lt;br/>Competition Setup]\n    Select --> LoadSetup[BowSetupViewModel&lt;br/>loadBowSetupForEdit]\n    \n    LoadSetup --> RepoGet[BowSetupRepository&lt;br/>getBowSetupWithEquipment]\n    RepoGet --> FetchComponents[Fetch Setup +&lt;br/>All Components]\n    FetchComponents --> Display[BowSetupDetailScreen&lt;br/>Displays]\n    \n    Display --> ClickPerf[User Clicks&lt;br/>Performance Tab]\n    ClickPerf --> PerfTab[BowSetupPerformanceTab&lt;br/>Displays]\n    \n    PerfTab --> CheckCache{Check Stats&lt;br/>Cache}\n    CheckCache --> CacheQuery[EquipmentStatsDao&lt;br/>getValidCacheEntry]\n    CacheQuery --> CacheValid{Cache Valid?}\n    \n    CacheValid -->|Yes, validUntil > now| ReturnCached[Return Cached&lt;br/>Statistics]\n    ReturnCached --> DisplayStats\n    \n    CacheValid -->|No, miss or expired| QuerySnapshots[Query Arrow&lt;br/>Snapshots]\n    QuerySnapshots --> GetSnapshots[EquipmentStatsDao&lt;br/>getSnapshotsForBowSetupVersion]\n    GetSnapshots --> SnapshotsDB[(Database&lt;br/>arrow_equipment_snapshot)]\n    SnapshotsDB --> JoinArrows[Join to&lt;br/>ArrowScore]\n    \n    JoinArrows --> Aggregate[Aggregate Metrics&lt;br/>totalArrows, averageScore&lt;br/>xCount, tenCount]\n    Aggregate --> CalcDerived[Calculate Derived&lt;br/>accuracy, consistency&lt;br/>missRate]\n    CalcDerived --> CreateStats[EquipmentPerformanceStats&lt;br/>Data Class]\n    \n    CreateStats --> CacheResults[Create Cache Entry&lt;br/>validUntil = now + duration]\n    CacheResults --> InsertCache[(Database&lt;br/>INSERT equipment_stats_cache)]\n    InsertCache --> DisplayStats[Display Statistics]\n    \n    DisplayStats --> ShowBasic[Show Basic Stats&lt;br/>Accuracy, Average, X Count&lt;br/>10 Count, Consistency]\n    \n    ShowBasic --> AdvancedCheck{Advanced&lt;br/>Analytics?}\n    AdvancedCheck -->|No| DateFilter\n    \n    AdvancedCheck -->|Yes| CalcAdvanced[Calculate Advanced&lt;br/>Shot Grouping&lt;br/>Fatigue Metrics&lt;br/>Consistency Analysis]\n    CalcAdvanced --> ShowAdvanced[Display Advanced&lt;br/>Eccentricity, Bias&lt;br/>Performance Drop&lt;br/>Trends]\n    ShowAdvanced --> DateFilter\n    \n    DateFilter --> FilterDate{User Filters&lt;br/>Date Range?}\n    FilterDate -->|Yes| Invalidate[Invalidate Cache&lt;br/>Recalculate with Filter]\n    Invalidate --> QuerySnapshots\n    FilterDate -->|No| End([Statistics&lt;br/>Displayed])\n    \n    style Start fill:#e1f5ff\n    style End fill:#c8e6c9\n    style ReturnCached fill:#c8e6c9\n    style CalcAdvanced fill:#f3e5f5&quot;">flowchart TD
    Start([Navigate to&lt;br/>Equipment]) --> List[Equipment List&lt;br/>getAllBowSetups]
    List --> Select[User Selects&lt;br/>Competition Setup]
    Select --> LoadSetup[BowSetupViewModel&lt;br/>loadBowSetupForEdit]
    
    LoadSetup --> RepoGet[BowSetupRepository&lt;br/>getBowSetupWithEquipment]
    RepoGet --> FetchComponents[Fetch Setup +&lt;br/>All Components]
    FetchComponents --> Display[BowSetupDetailScreen&lt;br/>Displays]
    
    Display --> ClickPerf[User Clicks&lt;br/>Performance Tab]
    ClickPerf --> PerfTab[BowSetupPerformanceTab&lt;br/>Displays]
    
    PerfTab --> CheckCache{Check Stats&lt;br/>Cache}
    CheckCache --> CacheQuery[EquipmentStatsDao&lt;br/>getValidCacheEntry]
    CacheQuery --> CacheValid{Cache Valid?}
    
    CacheValid -->|Yes, validUntil > now| ReturnCached[Return Cached&lt;br/>Statistics]
    ReturnCached --> DisplayStats
    
    CacheValid -->|No, miss or expired| QuerySnapshots[Query Arrow&lt;br/>Snapshots]
    QuerySnapshots --> GetSnapshots[EquipmentStatsDao&lt;br/>getSnapshotsForBowSetupVersion]
    GetSnapshots --> SnapshotsDB[(Database&lt;br/>arrow_equipment_snapshot)]
    SnapshotsDB --> JoinArrows[Join to&lt;br/>ArrowScore]
    
    JoinArrows --> Aggregate[Aggregate Metrics&lt;br/>totalArrows, averageScore&lt;br/>xCount, tenCount]
    Aggregate --> CalcDerived[Calculate Derived&lt;br/>accuracy, consistency&lt;br/>missRate]
    CalcDerived --> CreateStats[EquipmentPerformanceStats&lt;br/>Data Class]
    
    CreateStats --> CacheResults[Create Cache Entry&lt;br/>validUntil = now + duration]
    CacheResults --> InsertCache[(Database&lt;br/>INSERT equipment_stats_cache)]
    InsertCache --> DisplayStats[Display Statistics]
    
    DisplayStats --> ShowBasic[Show Basic Stats&lt;br/>Accuracy, Average, X Count&lt;br/>10 Count, Consistency]
    
    ShowBasic --> AdvancedCheck{Advanced&lt;br/>Analytics?}
    AdvancedCheck -->|No| DateFilter
    
    AdvancedCheck -->|Yes| CalcAdvanced[Calculate Advanced&lt;br/>Shot Grouping&lt;br/>Fatigue Metrics&lt;br/>Consistency Analysis]
    CalcAdvanced --> ShowAdvanced[Display Advanced&lt;br/>Eccentricity, Bias&lt;br/>Performance Drop&lt;br/>Trends]
    ShowAdvanced --> DateFilter
    
    DateFilter --> FilterDate{User Filters&lt;br/>Date Range?}
    FilterDate -->|Yes| Invalidate[Invalidate Cache&lt;br/>Recalculate with Filter]
    Invalidate --> QuerySnapshots
    FilterDate -->|No| End([Statistics&lt;br/>Displayed])
    
    style Start fill:#e1f5ff
    style End fill:#c8e6c9
    style ReturnCached fill:#c8e6c9
    style CalcAdvanced fill:#f3e5f5
</code><div id="mermaid-container" role="dialog"><div id="mermaid-space"><div class="mermaid-content"></div></div></div></pre>
<p><strong>1. Navigate to Equipment</strong></p>
<pre><code>User clicks &quot;Equipment&quot; in bottom nav
→ Equipment list displays all bow setups
→ BowSetupRepository.getAllBowSetups()
   - Location: BowSetupRepository.kt:56
   - Returns Flow&lt;List&lt;BowSetup>>
</code></pre>
<p><strong>2. Select Setup</strong></p>
<pre><code>User clicks &quot;Competition Setup&quot;
→ Navigate to BowSetupDetailScreen(setupId)
→ BowSetupViewModel.loadBowSetupForEdit(setupId)
   - Location: BowSetupViewModel.kt:loadBowSetupForEdit()
   - Loads complete setup with equipment
   
→ BowSetupRepository.getBowSetupWithEquipment(setupId)
   - Location: BowSetupRepository.kt:260-312
   - Fetches setup + all components
   - Returns BowSetupWithEquipment
</code></pre>
<p><strong>3. View Performance Tab</strong></p>
<pre><code>User clicks &quot;Performance&quot; tab
→ BowSetupPerformanceTab displays
→ Triggers statistics calculation
</code></pre>
<p><strong>4. Statistics Aggregation</strong></p>
<pre><code>// Check cache first
→ EquipmentStatsDao.getValidCacheEntry(cacheKey)
   - Location: EquipmentStatsDao.kt:59
   - Returns cached stats if valid
   
If cache miss or expired:
→ Calculate statistics from raw data
   
→ Query arrow snapshots:
   - EquipmentStatsDao.getSnapshotsForBowSetupVersion(setupId, version)
   - Location: EquipmentStatsDao.kt:38
   - Returns List&lt;ArrowEquipmentSnapshot>
   
→ Aggregate performance metrics:
   - Total arrows, average score, X count, 10 count
   - Calculate accuracy, consistency, miss rate
   - Location: EquipmentStatsModels.kt:39-54
   
→ Cache results:
   - Create EquipmentStatsCache entry
   - Set validUntil = now + cacheDuration
   - EquipmentStatsDao.insertStatsCache(cache)
</code></pre>
<p><strong>5. Display Statistics</strong></p>
<pre><code>Performance Tab shows:
- **Accuracy**: (tenCount / totalArrows) * 100
- **Average Score**: Sum of all arrow scores / totalArrows
- **X Count**: Count of X-ring hits
- **10 Count**: Count of 10-ring hits
- **Consistency**: (nineOrBetterCount / totalArrows) * 100
- **Miss Rate**: (missCount / totalArrows) * 100
- **Rounds Completed**: Distinct round count
- **First Used**: Timestamp of first arrow
- **Last Used**: Timestamp of most recent arrow
</code></pre>
<p><strong>6. Advanced Analytics (If Enabled)</strong></p>
<pre><code>Advanced Statistics Tab shows:

**Shot Grouping Analysis**:
→ AdvancedShotGrouping calculated
   - Location: EquipmentStatsModels.kt:94-150
   - Eccentricity (1.0 = circular, >1.0 = elliptical)
   - Group center (x, y coordinates)
   - Horizontal/vertical bias
   - Primary axis angle
   - Average group size
   - Radial consistency

**Fatigue Metrics**:
→ FatigueMetrics calculated
   - Location: EquipmentStatsModels.kt:155-175
   - Recent vs. earlier performance comparison
   - Performance drop percentage
   - Grouping deterioration
   - Fatigue score (0-1 scale)
   - Recommendations based on fatigue level

**Consistency Analysis**:
→ ConsistencyMetrics calculated
   - Location: EquipmentStatsModels.kt:180-202
   - Score variation across ends
   - Performance trend (improving/declining/stable)
   - Consistency percentage
   - Most/least consistent ends

**Distance-Specific Performance**:
→ EquipmentDistancePerformance queried
   - Location: EquipmentStatsModels.kt:76-85
   - Breakdown by distance (18m, 30m, 50m, 70m, etc.)
   - Accuracy and score average per distance
   - 10 count percentage per distance
</code></pre>
<p><strong>7. Filter by Date Range</strong></p>
<pre><code>User selects date range: &quot;Last 30 days&quot;
→ Statistics recalculated with filter
→ Only arrows from selected range included
→ Cache invalidated, new cache entry created
</code></pre>
<p><strong>File References:</strong></p>
<ul>
<li>BowSetupDetailScreen.kt - Performance tab UI</li>
<li>BowSetupViewModel.kt - Statistics state management</li>
<li>BowSetupRepository.kt:260-312 - Setup + equipment retrieval</li>
<li>EquipmentStatsDao.kt:38, 59 - Snapshot queries + cache</li>
<li>EquipmentStatsModels.kt:39-54, 94-202 - Statistics calculation</li>
</ul>
<hr/>
<h3 id="journey-4-edit-equipment">Journey 4: Edit Equipment<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#journey-4-edit-equipment" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><strong>Flow:</strong> Equipment List → Setup Detail → Edit Components → Save Changes</p>
<pre><button class="expand-button" aria-label="Expand mermaid diagram" data-view-component="true"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path fill-rule="evenodd" d="M3.72 3.72a.75.75 0 011.06 1.06L2.56 7h10.88l-2.22-2.22a.75.75 0 011.06-1.06l3.5 3.5a.75.75 0 010 1.06l-3.5 3.5a.75.75 0 11-1.06-1.06l2.22-2.22H2.56l2.22 2.22a.75.75 0 11-1.06 1.06l-3.5-3.5a.75.75 0 010-1.06l3.5-3.5z"></path></svg></button><code class="mermaid" data-clipboard="&quot;flowchart TD\n    Start([Navigate to&lt;br/>Equipment]) --> List[Equipment List]\n    List --> SelectSetup[User Selects&lt;br/>Competition Setup]\n    SelectSetup --> LoadEdit[BowSetupViewModel&lt;br/>loadBowSetupForEdit]\n    \n    LoadEdit --> SetEditMode[isEditing = true&lt;br/>editingId = setupId]\n    SetEditMode --> LoadData[BowSetupRepository&lt;br/>getBowSetupWithEquipment]\n    LoadData --> PopulateForm[Populate InputState&lt;br/>with Current Data]\n    PopulateForm --> DisplayForm[BowSetupDetailScreen&lt;br/>Edit Mode]\n    \n    DisplayForm --> UserEdits[User Clicks&lt;br/>Change Sight]\n    UserEdits --> NavSight[Navigate to&lt;br/>SightDetailScreen]\n    NavSight --> SelectNewSight[User Selects&lt;br/>New Sight]\n    SelectNewSight --> UpdateVM[BowSetupViewModel&lt;br/>updateSightId]\n    UpdateVM --> BackToForm[Back to&lt;br/>Detail Screen]\n    \n    BackToForm --> ClickSave[User Clicks&lt;br/>Save Changes]\n    ClickSave --> CheckActive{Active Rounds&lt;br/>Using Equipment?}\n    \n    CheckActive -->|Yes| ShowWarning[Show Warning Dialog&lt;br/>Equipment in Active Rounds]\n    ShowWarning --> UserChoice{User Chooses}\n    \n    UserChoice -->|Create New Version| CreateVersion[BowSetupRepository&lt;br/>createNewVersion]\n    CreateVersion --> IncrementVer[Increment Version&lt;br/>version = original + 1]\n    IncrementVer --> CopySetup[Create New Setup&lt;br/>with New Version]\n    CopySetup --> CopyEquipment[Copy All Equipment&lt;br/>to New Setup]\n    CopyEquipment --> ApplyChanges[Apply Changes to&lt;br/>New Version]\n    ApplyChanges --> SaveSuccess\n    \n    UserChoice -->|Update Anyway| DirectUpdate\n    UserChoice -->|Cancel| DisplayForm\n    \n    CheckActive -->|No| DirectUpdate[Validate Input]\n    DirectUpdate --> ValidCheck{Valid?}\n    \n    ValidCheck -->|No| ShowError[Show Validation&lt;br/>Error]\n    ShowError --> DisplayForm\n    \n    ValidCheck -->|Yes| RepoUpdate[BowSetupRepository&lt;br/>updateBowSetup]\n    RepoUpdate --> UpdateTimestamp[Update Timestamp&lt;br/>updatedAt = now]\n    UpdateTimestamp --> RemoveOld[Remove Old Equipment&lt;br/>removeEquipmentFromSetup]\n    RemoveOld --> AddNew[Add New Equipment&lt;br/>addEquipmentToSetup]\n    AddNew --> InvalidateCache[Invalidate&lt;br/>Statistics Cache]\n    InvalidateCache --> SaveSuccess[SaveResult.Success]\n    \n    SaveSuccess --> Refresh[Refresh Setup List&lt;br/>loadBowSetups]\n    Refresh --> End([Setup Updated])\n    \n    style Start fill:#e1f5ff\n    style End fill:#c8e6c9\n    style ShowWarning fill:#fff9c4\n    style ShowError fill:#ffcdd2&quot;">flowchart TD
    Start([Navigate to&lt;br/>Equipment]) --> List[Equipment List]
    List --> SelectSetup[User Selects&lt;br/>Competition Setup]
    SelectSetup --> LoadEdit[BowSetupViewModel&lt;br/>loadBowSetupForEdit]
    
    LoadEdit --> SetEditMode[isEditing = true&lt;br/>editingId = setupId]
    SetEditMode --> LoadData[BowSetupRepository&lt;br/>getBowSetupWithEquipment]
    LoadData --> PopulateForm[Populate InputState&lt;br/>with Current Data]
    PopulateForm --> DisplayForm[BowSetupDetailScreen&lt;br/>Edit Mode]
    
    DisplayForm --> UserEdits[User Clicks&lt;br/>Change Sight]
    UserEdits --> NavSight[Navigate to&lt;br/>SightDetailScreen]
    NavSight --> SelectNewSight[User Selects&lt;br/>New Sight]
    SelectNewSight --> UpdateVM[BowSetupViewModel&lt;br/>updateSightId]
    UpdateVM --> BackToForm[Back to&lt;br/>Detail Screen]
    
    BackToForm --> ClickSave[User Clicks&lt;br/>Save Changes]
    ClickSave --> CheckActive{Active Rounds&lt;br/>Using Equipment?}
    
    CheckActive -->|Yes| ShowWarning[Show Warning Dialog&lt;br/>Equipment in Active Rounds]
    ShowWarning --> UserChoice{User Chooses}
    
    UserChoice -->|Create New Version| CreateVersion[BowSetupRepository&lt;br/>createNewVersion]
    CreateVersion --> IncrementVer[Increment Version&lt;br/>version = original + 1]
    IncrementVer --> CopySetup[Create New Setup&lt;br/>with New Version]
    CopySetup --> CopyEquipment[Copy All Equipment&lt;br/>to New Setup]
    CopyEquipment --> ApplyChanges[Apply Changes to&lt;br/>New Version]
    ApplyChanges --> SaveSuccess
    
    UserChoice -->|Update Anyway| DirectUpdate
    UserChoice -->|Cancel| DisplayForm
    
    CheckActive -->|No| DirectUpdate[Validate Input]
    DirectUpdate --> ValidCheck{Valid?}
    
    ValidCheck -->|No| ShowError[Show Validation&lt;br/>Error]
    ShowError --> DisplayForm
    
    ValidCheck -->|Yes| RepoUpdate[BowSetupRepository&lt;br/>updateBowSetup]
    RepoUpdate --> UpdateTimestamp[Update Timestamp&lt;br/>updatedAt = now]
    UpdateTimestamp --> RemoveOld[Remove Old Equipment&lt;br/>removeEquipmentFromSetup]
    RemoveOld --> AddNew[Add New Equipment&lt;br/>addEquipmentToSetup]
    AddNew --> InvalidateCache[Invalidate&lt;br/>Statistics Cache]
    InvalidateCache --> SaveSuccess[SaveResult.Success]
    
    SaveSuccess --> Refresh[Refresh Setup List&lt;br/>loadBowSetups]
    Refresh --> End([Setup Updated])
    
    style Start fill:#e1f5ff
    style End fill:#c8e6c9
    style ShowWarning fill:#fff9c4
    style ShowError fill:#ffcdd2
</code><div id="mermaid-container" role="dialog"><div id="mermaid-space"><div class="mermaid-content"></div></div></div></pre>
<p><strong>1. Navigate to Equipment</strong></p>
<pre><code>User clicks &quot;Equipment&quot; in bottom nav
→ Equipment list displays
</code></pre>
<p><strong>2. Select Existing Setup</strong></p>
<pre><code>User clicks &quot;Competition Setup&quot;
→ Navigate to BowSetupDetailScreen(setupId)
→ BowSetupViewModel.loadBowSetupForEdit(setupId)
   - Location: BowSetupViewModel.kt:loadBowSetupForEdit()
   - Sets isEditing = true, editingId = setupId
   - Loads current setup data into inputState
   
→ BowSetupRepository.getBowSetupWithEquipment(setupId)
   - Location: BowSetupRepository.kt:260-312
   - Returns complete setup with all components
</code></pre>
<p><strong>3. Modify Components</strong></p>
<pre><code>User clicks &quot;Change Sight&quot;
→ Navigation to SightDetailScreen
→ User selects new sight
→ BowSetupViewModel.updateSightId(newSightId)
   - Location: BowSetupViewModel.kt:updateSightId()
   - Updates inputState.sightId
</code></pre>
<p><strong>4. Save Changes</strong></p>
<pre><code>User clicks &quot;Save Changes&quot;
→ BowSetupViewModel.saveBowSetup()
   - Location: BowSetupViewModel.kt:saveBowSetup()
   - Validates changes
   - Since isEditing = true, performs update instead of insert
   
→ BowSetupRepository.updateBowSetup(bowSetup.copy(updatedAt = Date()))
   - Location: BowSetupRepository.kt:84
   - Updates setup timestamp
   
→ For changed components:
   - BowSetupRepository.removeEquipmentFromSetup(setupId, type, oldId)
   - Location: BowSetupRepository.kt:239-251
   - Deletes old BowSetupEquipment entry
   
   - BowSetupRepository.addEquipmentToSetup(setupId, type, newId)
   - Location: BowSetupRepository.kt:219-237
   - Inserts new BowSetupEquipment entry
</code></pre>
<p><strong>5. Version Decision Point</strong></p>
<pre><code>User has option: &quot;Create New Version&quot; or &quot;Update Existing&quot;

If &quot;Create New Version&quot;:
→ BowSetupViewModel.createNewVersionAndSave()
   
→ BowSetupRepository.createNewVersion(originalSetupId, newName)
   - Location: BowSetupRepository.kt:315-348
   - Increments version number
   - Creates new BowSetup with version = original.version + 1
   - Copies all equipment to new version
   - Returns new setupId
   
→ Apply changes to new version setup
→ Original setup remains unchanged (historical record)

If &quot;Update Existing&quot;:
→ Direct update as described in step 4
→ Existing setup modified
</code></pre>
<p><strong>6. Handle Rounds Using Equipment</strong></p>
<pre><code>When equipment is modified:
→ Check if any active rounds use this equipment
   - Query: rounds WHERE bowSetupId = setupId AND status != COMPLETED
   
If active rounds exist:
→ Show warning: &quot;Equipment is used in active rounds&quot;
→ Options:
   1. &quot;Create New Version&quot; - Recommended (preserves history)
   2. &quot;Update Anyway&quot; - Updates setup, active rounds see changes
   3. &quot;Cancel&quot; - Abort edit
</code></pre>
<p><strong>7. Statistics Cache Invalidation</strong></p>
<pre><code>On equipment update:
→ Invalidate statistics cache for this equipment
→ EquipmentStatsDao.deleteCacheForEquipment(setupId)
   - Location: EquipmentStatsDao.kt:79
→ Next statistics view will recalculate from raw data
</code></pre>
<p><strong>File References:</strong></p>
<ul>
<li>BowSetupDetailScreen.kt - Edit UI</li>
<li>BowSetupViewModel.kt - Edit state management</li>
<li>BowSetupRepository.kt:84, 219-251, 315-348 - Update + versioning operations</li>
<li>BowSetupDao.kt:22, 53, 56 - Database updates</li>
<li>EquipmentStatsDao.kt:79 - Cache invalidation</li>
</ul>
<hr/>
<h2 id="multi-participant-equipment-flow">Multi-Participant Equipment Flow<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#multi-participant-equipment-flow" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="guest-setup-auto-creation">Guest Setup Auto-Creation<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#guest-setup-auto-creation" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<pre><button class="expand-button" aria-label="Expand mermaid diagram" data-view-component="true"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path fill-rule="evenodd" d="M3.72 3.72a.75.75 0 011.06 1.06L2.56 7h10.88l-2.22-2.22a.75.75 0 011.06-1.06l3.5 3.5a.75.75 0 010 1.06l-3.5 3.5a.75.75 0 11-1.06-1.06l2.22-2.22H2.56l2.22 2.22a.75.75 0 11-1.06 1.06l-3.5-3.5a.75.75 0 010-1.06l3.5-3.5z"></path></svg></button><code class="mermaid" data-clipboard="&quot;flowchart TD\n    Start([Create Multi-Participant&lt;br/>Round]) --> RoundCreate[RoundViewModel&lt;br/>createMultiParticipantRound]\n    RoundCreate --> Participants[Participants:&lt;br/>Main User&lt;br/>Guest: Alice&lt;br/>Guest: Bob]\n    \n    Participants --> MainUser{Main User&lt;br/>Equipment}\n    MainUser --> SelectMain[User Selects&lt;br/>Competition Setup]\n    SelectMain --> AssignMain[Round.bowSetupId =&lt;br/>selectedSetupId]\n    \n    Participants --> GuestLoop{For Each&lt;br/>Guest Participant}\n    \n    GuestLoop --> GuestAlice[Guest: Alice]\n    GuestAlice --> CheckAlice[BowSetupRepository&lt;br/>getOrCreateGuestBowSetup&lt;br/>participant=Alice, roundId]\n    \n    CheckAlice --> QueryAlice[BowSetupDao&lt;br/>getGuestSetupForParticipant&lt;br/>participantId=alice.id]\n    QueryAlice --> ExistAlice{Guest Setup&lt;br/>Exists?}\n    \n    ExistAlice -->|Yes| ReturnAlice[Return Existing&lt;br/>Guest Setup - Alice]\n    \n    ExistAlice -->|No| CreateAlice[Create New BowSetup&lt;br/>name=Guest Setup - Alice&lt;br/>isGuestSetup=true]\n    CreateAlice --> LinkAlice[parentParticipantId=alice.id&lt;br/>sourceRoundId=roundId]\n    LinkAlice --> InsertAlice[(Database&lt;br/>INSERT bow_setup)]\n    InsertAlice --> ReturnAlice\n    \n    ReturnAlice --> GuestBob[Guest: Bob]\n    GuestBob --> CheckBob[getOrCreateGuestBowSetup&lt;br/>participant=Bob]\n    CheckBob --> CreateBob[Create or Return&lt;br/>Guest Setup - Bob]\n    CreateBob --> AssignMain\n    \n    AssignMain --> RoundReady[Round Created&lt;br/>Equipment Assigned]\n    RoundReady --> Shooting[During Shooting]\n    \n    Shooting --> AliceShot[Alice Shoots Arrow]\n    AliceShot --> AliceSnap[ArrowEquipmentSnapshot&lt;br/>bowSetupId=alice_guest_setup_id&lt;br/>participantId=alice.id]\n    \n    Shooting --> BobShot[Bob Shoots Arrow]\n    BobShot --> BobSnap[ArrowEquipmentSnapshot&lt;br/>bowSetupId=bob_guest_setup_id&lt;br/>participantId=bob.id]\n    \n    Shooting --> MainShot[Main User Shoots]\n    MainShot --> MainSnap[ArrowEquipmentSnapshot&lt;br/>bowSetupId=competition_setup_id&lt;br/>participantId=main_user_id]\n    \n    AliceSnap --> Stats[Statistics Tracked&lt;br/>Independently Per Participant]\n    BobSnap --> Stats\n    MainSnap --> Stats\n    \n    Stats --> SelectableCheck{Guest Setups&lt;br/>Selectable?}\n    SelectableCheck --> Isolation[NO - Guest Setups&lt;br/>Excluded from Main User&lt;br/>getSelectableBowSetups]\n    \n    Isolation --> Cleanup{Round&lt;br/>Deleted?}\n    Cleanup -->|Yes| CleanupGuest[cleanupGuestSetupsForRound&lt;br/>Set isActive=false]\n    Cleanup -->|No| End([Independent Equipment&lt;br/>Tracking])\n    CleanupGuest --> End\n    \n    style Start fill:#e1f5ff\n    style End fill:#c8e6c9\n    style CreateAlice fill:#fff9c4\n    style CreateBob fill:#fff9c4\n    style Stats fill:#f3e5f5&quot;">flowchart TD
    Start([Create Multi-Participant&lt;br/>Round]) --> RoundCreate[RoundViewModel&lt;br/>createMultiParticipantRound]
    RoundCreate --> Participants[Participants:&lt;br/>Main User&lt;br/>Guest: Alice&lt;br/>Guest: Bob]
    
    Participants --> MainUser{Main User&lt;br/>Equipment}
    MainUser --> SelectMain[User Selects&lt;br/>Competition Setup]
    SelectMain --> AssignMain[Round.bowSetupId =&lt;br/>selectedSetupId]
    
    Participants --> GuestLoop{For Each&lt;br/>Guest Participant}
    
    GuestLoop --> GuestAlice[Guest: Alice]
    GuestAlice --> CheckAlice[BowSetupRepository&lt;br/>getOrCreateGuestBowSetup&lt;br/>participant=Alice, roundId]
    
    CheckAlice --> QueryAlice[BowSetupDao&lt;br/>getGuestSetupForParticipant&lt;br/>participantId=alice.id]
    QueryAlice --> ExistAlice{Guest Setup&lt;br/>Exists?}
    
    ExistAlice -->|Yes| ReturnAlice[Return Existing&lt;br/>Guest Setup - Alice]
    
    ExistAlice -->|No| CreateAlice[Create New BowSetup&lt;br/>name=Guest Setup - Alice&lt;br/>isGuestSetup=true]
    CreateAlice --> LinkAlice[parentParticipantId=alice.id&lt;br/>sourceRoundId=roundId]
    LinkAlice --> InsertAlice[(Database&lt;br/>INSERT bow_setup)]
    InsertAlice --> ReturnAlice
    
    ReturnAlice --> GuestBob[Guest: Bob]
    GuestBob --> CheckBob[getOrCreateGuestBowSetup&lt;br/>participant=Bob]
    CheckBob --> CreateBob[Create or Return&lt;br/>Guest Setup - Bob]
    CreateBob --> AssignMain
    
    AssignMain --> RoundReady[Round Created&lt;br/>Equipment Assigned]
    RoundReady --> Shooting[During Shooting]
    
    Shooting --> AliceShot[Alice Shoots Arrow]
    AliceShot --> AliceSnap[ArrowEquipmentSnapshot&lt;br/>bowSetupId=alice_guest_setup_id&lt;br/>participantId=alice.id]
    
    Shooting --> BobShot[Bob Shoots Arrow]
    BobShot --> BobSnap[ArrowEquipmentSnapshot&lt;br/>bowSetupId=bob_guest_setup_id&lt;br/>participantId=bob.id]
    
    Shooting --> MainShot[Main User Shoots]
    MainShot --> MainSnap[ArrowEquipmentSnapshot&lt;br/>bowSetupId=competition_setup_id&lt;br/>participantId=main_user_id]
    
    AliceSnap --> Stats[Statistics Tracked&lt;br/>Independently Per Participant]
    BobSnap --> Stats
    MainSnap --> Stats
    
    Stats --> SelectableCheck{Guest Setups&lt;br/>Selectable?}
    SelectableCheck --> Isolation[NO - Guest Setups&lt;br/>Excluded from Main User&lt;br/>getSelectableBowSetups]
    
    Isolation --> Cleanup{Round&lt;br/>Deleted?}
    Cleanup -->|Yes| CleanupGuest[cleanupGuestSetupsForRound&lt;br/>Set isActive=false]
    Cleanup -->|No| End([Independent Equipment&lt;br/>Tracking])
    CleanupGuest --> End
    
    style Start fill:#e1f5ff
    style End fill:#c8e6c9
    style CreateAlice fill:#fff9c4
    style CreateBob fill:#fff9c4
    style Stats fill:#f3e5f5
</code><div id="mermaid-container" role="dialog"><div id="mermaid-space"><div class="mermaid-content"></div></div></div></pre>
<p>When creating multi-participant round:</p>
<p><strong>1. Round Creation with Participants</strong></p>
<pre><code>User creates round with participants:
- Local User (Main User)
- Guest Archer 1 &quot;Alice&quot;
- Guest Archer 2 &quot;Bob&quot;

→ RoundViewModel.createMultiParticipantRound(participants)
</code></pre>
<p><strong>2. Equipment Assignment</strong></p>
<pre><code>Main User:
→ User selects existing bow setup: &quot;Competition Setup&quot;
→ Round.bowSetupId = selectedSetupId

Guest Archers (Alice, Bob):
→ For each guest:
   - BowSetupRepository.getOrCreateGuestBowSetup(participant, roundId)
   - Location: BowSetupRepository.kt:99-127
   
   Check if exists:
   → BowSetupDao.getGuestSetupForParticipant(participantId, roundId)
   → If exists: Return existing guest setup
   
   If not exists:
   → Create new BowSetup:
      - name = &quot;Guest Setup - Alice&quot;
      - isGuestSetup = true
      - parentParticipantId = alice.id
      - sourceRoundId = roundId
      - isActive = true
   → insertBowSetup(guestSetup)
   → Return new guest setup
</code></pre>
<p><strong>3. Guest Setup Isolation</strong></p>
<pre><code>Guest setups are:
- NOT selectable by main user in dropdowns
  - BowSetupDao.getSelectableBowSetups() excludes isGuestSetup = true
  - BowSetup.isSelectableByMainUser() returns false for guest setups

- Only visible in guest's round context
  - Associated with specific participantId + roundId
  
- Automatically cleaned up when round deleted
  - BowSetupRepository.cleanupGuestSetupsForRound(roundId)
  - Location: BowSetupRepository.kt:144-146
  - Sets isActive = false for all guest setups in round
</code></pre>
<p><strong>4. Statistics Tracking Per Participant</strong></p>
<pre><code>Each arrow shot in multi-participant round:
→ ArrowScore created with participantId
→ ArrowEquipmentSnapshot created with:
   - bowSetupId = guest setup ID (for Alice/Bob)
   - bowSetupId = user setup ID (for main user)
   - participantId = shooter's ID
   
Statistics queries filter by participantId + bowSetupId:
→ Alice's performance with &quot;Guest Setup - Alice&quot;
→ Bob's performance with &quot;Guest Setup - Bob&quot;
→ Main User's performance with &quot;Competition Setup&quot;
→ All independent and separately tracked
</code></pre>
<p><strong>5. Guest Setup Cleanup</strong></p>
<pre><code>Periodic maintenance (app startup):
→ BowSetupRepository.cleanupOrphanedGuestSetups()
   - Location: BowSetupRepository.kt:195-216
   - Finds guest setups where sourceRoundId doesn't exist
   - Soft deletes orphaned setups (isActive = false)
   - Returns count of cleaned setups
</code></pre>
<hr/>
<h2 id="statistics-tracking-deep-dive">Statistics Tracking Deep Dive<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#statistics-tracking-deep-dive" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="equipment-snapshot--statistics-flow">Equipment Snapshot &amp; Statistics Flow<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#equipment-snapshot--statistics-flow" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<pre><button class="expand-button" aria-label="Expand mermaid diagram" data-view-component="true"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path fill-rule="evenodd" d="M3.72 3.72a.75.75 0 011.06 1.06L2.56 7h10.88l-2.22-2.22a.75.75 0 011.06-1.06l3.5 3.5a.75.75 0 010 1.06l-3.5 3.5a.75.75 0 11-1.06-1.06l2.22-2.22H2.56l2.22 2.22a.75.75 0 11-1.06 1.06l-3.5-3.5a.75.75 0 010-1.06l3.5-3.5z"></path></svg></button><code class="mermaid" data-clipboard="&quot;flowchart TD\n    Start([Arrow Shot]) --> CreateArrow[Create ArrowScore&lt;br/>scoreValue, isX, etc.]\n    CreateArrow --> ArrowSaved[(Database&lt;br/>INSERT arrow_score)]\n    ArrowSaved --> CreateSnap[Create ArrowEquipmentSnapshot]\n    \n    CreateSnap --> SnapData[Capture Data:&lt;br/>bowSetupId&lt;br/>bowSetupVersion&lt;br/>riserId, limbsId, sightId&lt;br/>all component IDs]\n    SnapData --> SaveSnap[(Database&lt;br/>INSERT arrow_equipment_snapshot&lt;br/>capturedAt=now)]\n    \n    SaveSnap --> CheckCache{Statistics&lt;br/>Cache Valid?}\n    CheckCache -->|Yes| Continue[Continue Shooting]\n    CheckCache -->|No| InvalidateCache[Invalidate Cache&lt;br/>deleteCacheForEquipment]\n    InvalidateCache --> Continue\n    \n    Continue --> ViewStats{User Views&lt;br/>Statistics?}\n    ViewStats -->|No| End([Snapshot Preserved])\n    \n    ViewStats -->|Yes| QueryCache[EquipmentStatsDao&lt;br/>getValidCacheEntry]\n    QueryCache --> CacheCheck{Cache Valid?}\n    \n    CacheCheck -->|Yes, validUntil > now| ReturnCache[Return Cached&lt;br/>EquipmentPerformanceStats]\n    ReturnCache --> DisplayCache[Display Statistics]\n    DisplayCache --> End\n    \n    CacheCheck -->|No, expired or missing| FetchSnapshots[EquipmentStatsDao&lt;br/>getSnapshotsForBowSetupVersion]\n    FetchSnapshots --> SnapshotsDB[(Database&lt;br/>SELECT arrow_equipment_snapshot&lt;br/>WHERE bowSetupId, version)]\n    \n    SnapshotsDB --> JoinArrows[Join to ArrowScore&lt;br/>via arrowScoreId]\n    JoinArrows --> ArrowsDB[(Database&lt;br/>Get scoreValue, isX&lt;br/>scoredAt for each arrow)]\n    \n    ArrowsDB --> AggregateBasic[Aggregate Basic Metrics:&lt;br/>totalArrows = COUNT&lt;br/>averageScore = AVG&lt;br/>xCount = COUNT WHERE isX&lt;br/>tenCount = COUNT WHERE value=10]\n    \n    AggregateBasic --> CalcDerived[Calculate Derived:&lt;br/>accuracy = tenCount/total * 100&lt;br/>consistency = 9+count/total * 100&lt;br/>missRate = missCount/total * 100]\n    \n    CalcDerived --> CreateStats[Create EquipmentPerformanceStats&lt;br/>Data Class]\n    CreateStats --> CheckAdvanced{Calculate&lt;br/>Advanced Analytics?}\n    \n    CheckAdvanced -->|Yes| CalcGrouping[Shot Grouping Analysis&lt;br/>eccentricity, bias&lt;br/>group center, axis angle]\n    CalcGrouping --> CalcFatigue[Fatigue Detection&lt;br/>recent vs earlier&lt;br/>performance drop]\n    CalcFatigue --> CalcConsistency[Consistency Analysis&lt;br/>end-to-end variation&lt;br/>performance trends]\n    CalcConsistency --> CalcDistance[Distance-Specific&lt;br/>Breakdown by distance&lt;br/>accuracy per distance]\n    CalcDistance --> AdvancedReady\n    \n    CheckAdvanced -->|No| AdvancedReady[Statistics Ready]\n    AdvancedReady --> CacheIt[Create Cache Entry&lt;br/>validUntil = now + duration]\n    CacheIt --> InsertCache[(Database&lt;br/>INSERT equipment_stats_cache&lt;br/>statsData=JSON)]\n    \n    InsertCache --> DisplayStats[Display Statistics:&lt;br/>Accuracy, Average Score&lt;br/>X Count, 10 Count&lt;br/>Consistency, Miss Rate&lt;br/>+ Advanced if enabled]\n    DisplayStats --> End\n    \n    style Start fill:#e1f5ff\n    style End fill:#c8e6c9\n    style ReturnCache fill:#c8e6c9\n    style CalcGrouping fill:#f3e5f5\n    style CalcFatigue fill:#f3e5f5&quot;">flowchart TD
    Start([Arrow Shot]) --> CreateArrow[Create ArrowScore&lt;br/>scoreValue, isX, etc.]
    CreateArrow --> ArrowSaved[(Database&lt;br/>INSERT arrow_score)]
    ArrowSaved --> CreateSnap[Create ArrowEquipmentSnapshot]
    
    CreateSnap --> SnapData[Capture Data:&lt;br/>bowSetupId&lt;br/>bowSetupVersion&lt;br/>riserId, limbsId, sightId&lt;br/>all component IDs]
    SnapData --> SaveSnap[(Database&lt;br/>INSERT arrow_equipment_snapshot&lt;br/>capturedAt=now)]
    
    SaveSnap --> CheckCache{Statistics&lt;br/>Cache Valid?}
    CheckCache -->|Yes| Continue[Continue Shooting]
    CheckCache -->|No| InvalidateCache[Invalidate Cache&lt;br/>deleteCacheForEquipment]
    InvalidateCache --> Continue
    
    Continue --> ViewStats{User Views&lt;br/>Statistics?}
    ViewStats -->|No| End([Snapshot Preserved])
    
    ViewStats -->|Yes| QueryCache[EquipmentStatsDao&lt;br/>getValidCacheEntry]
    QueryCache --> CacheCheck{Cache Valid?}
    
    CacheCheck -->|Yes, validUntil > now| ReturnCache[Return Cached&lt;br/>EquipmentPerformanceStats]
    ReturnCache --> DisplayCache[Display Statistics]
    DisplayCache --> End
    
    CacheCheck -->|No, expired or missing| FetchSnapshots[EquipmentStatsDao&lt;br/>getSnapshotsForBowSetupVersion]
    FetchSnapshots --> SnapshotsDB[(Database&lt;br/>SELECT arrow_equipment_snapshot&lt;br/>WHERE bowSetupId, version)]
    
    SnapshotsDB --> JoinArrows[Join to ArrowScore&lt;br/>via arrowScoreId]
    JoinArrows --> ArrowsDB[(Database&lt;br/>Get scoreValue, isX&lt;br/>scoredAt for each arrow)]
    
    ArrowsDB --> AggregateBasic[Aggregate Basic Metrics:&lt;br/>totalArrows = COUNT&lt;br/>averageScore = AVG&lt;br/>xCount = COUNT WHERE isX&lt;br/>tenCount = COUNT WHERE value=10]
    
    AggregateBasic --> CalcDerived[Calculate Derived:&lt;br/>accuracy = tenCount/total * 100&lt;br/>consistency = 9+count/total * 100&lt;br/>missRate = missCount/total * 100]
    
    CalcDerived --> CreateStats[Create EquipmentPerformanceStats&lt;br/>Data Class]
    CreateStats --> CheckAdvanced{Calculate&lt;br/>Advanced Analytics?}
    
    CheckAdvanced -->|Yes| CalcGrouping[Shot Grouping Analysis&lt;br/>eccentricity, bias&lt;br/>group center, axis angle]
    CalcGrouping --> CalcFatigue[Fatigue Detection&lt;br/>recent vs earlier&lt;br/>performance drop]
    CalcFatigue --> CalcConsistency[Consistency Analysis&lt;br/>end-to-end variation&lt;br/>performance trends]
    CalcConsistency --> CalcDistance[Distance-Specific&lt;br/>Breakdown by distance&lt;br/>accuracy per distance]
    CalcDistance --> AdvancedReady
    
    CheckAdvanced -->|No| AdvancedReady[Statistics Ready]
    AdvancedReady --> CacheIt[Create Cache Entry&lt;br/>validUntil = now + duration]
    CacheIt --> InsertCache[(Database&lt;br/>INSERT equipment_stats_cache&lt;br/>statsData=JSON)]
    
    InsertCache --> DisplayStats[Display Statistics:&lt;br/>Accuracy, Average Score&lt;br/>X Count, 10 Count&lt;br/>Consistency, Miss Rate&lt;br/>+ Advanced if enabled]
    DisplayStats --> End
    
    style Start fill:#e1f5ff
    style End fill:#c8e6c9
    style ReturnCache fill:#c8e6c9
    style CalcGrouping fill:#f3e5f5
    style CalcFatigue fill:#f3e5f5
</code><div id="mermaid-container" role="dialog"><div id="mermaid-space"><div class="mermaid-content"></div></div></div></pre>
<h3 id="equipment-snapshot-capture">Equipment Snapshot Capture<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#equipment-snapshot-capture" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><strong>When:</strong> Every arrow shot is captured with equipment details</p>
<p><strong>Process:</strong></p>
<pre><code>1. User shoots arrow
   → ArrowScore created (id, endScoreId, arrowNumber, scoreValue, ...)
   → ArrowScore.bowSetupId = current equipment ID
   → ArrowScore.bowSetupVersion = current version
   
2. Equipment snapshot created
   → ArrowEquipmentSnapshot entity:
      - arrowScoreId: FK to ArrowScore
      - bowSetupId: Equipment used
      - bowSetupVersion: Version at time of shot
      - riserId, limbsId, sightId, ...: All component IDs
      - capturedAt: Timestamp
   
   → EquipmentStatsDao.insertEquipmentSnapshot(snapshot)
   
3. Cache invalidation
   → If new round or significant time gap:
      - Invalidate relevant cache entries
      - Force recalculation on next stats view
</code></pre>
<p><strong>Why Snapshot?</strong></p>
<ul>
<li>Historical accuracy: Equipment changes don’t affect past performance</li>
<li>Version tracking: Compare performance across equipment versions</li>
<li>Component analysis: Identify which component changes affect performance</li>
</ul>
<h3 id="performance-metrics-calculation">Performance Metrics Calculation<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#performance-metrics-calculation" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><strong>Basic Statistics</strong> (EquipmentStatsModels.kt:39-54):</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="kotlin" data-theme="github-light github-dark"><code data-language="kotlin" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> EquipmentPerformanceStats</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bowSetupId: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> totalArrows: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,              </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// COUNT(*) from snapshots</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> averageScore: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Double</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,          </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// AVG(scoreValue) from arrow_scores</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> xCount: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// COUNT WHERE isX = true</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tenCount: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                 </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// COUNT WHERE scoreValue = 10</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nineOrBetterCount: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,        </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// COUNT WHERE scoreValue >= 9</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> missCount: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// COUNT WHERE scoreValue = 0</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> firstShotAt: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,             </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// MIN(scoredAt)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lastShotAt: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,              </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// MAX(scoredAt)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> roundCount: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Int</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                // COUNT(DISTINCT roundId)</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Derived metrics</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> accuracy: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Double</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (tenCount.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toDouble</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> totalArrows) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> consistency: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Double</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (nineOrBetterCount.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toDouble</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> totalArrows) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> missRate: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Double</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (missCount.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toDouble</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> totalArrows) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></figure>
<p><strong>Query Path:</strong></p>
<pre><code>1. EquipmentStatsDao.getSnapshotsForBowSetupVersion(bowSetupId, version)
   → Returns List&lt;ArrowEquipmentSnapshot>
   
2. For each snapshot, join to ArrowScore:
   → Get scoreValue, isX, scoredAt
   
3. Aggregate in memory or database:
   → Total arrows: COUNT(*)
   → Average score: SUM(scoreValue) / COUNT(*)
   → X count: COUNT WHERE isX = true
   → 10 count: COUNT WHERE scoreValue = 10
   → Miss count: COUNT WHERE scoreValue = 0
   
4. Calculate derived metrics:
   → accuracy = (10 count / total) * 100
   → consistency = (9+ count / total) * 100
   
5. Cache results:
   → EquipmentStatsCache entry with validUntil timestamp
</code></pre>
<h3 id="advanced-analytics">Advanced Analytics<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#advanced-analytics" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><strong>Shot Grouping Analysis</strong> (EquipmentStatsModels.kt:94-150):</p>
<pre><code>Requires arrow coordinates (xCoordinate, yCoordinate, targetCenterX, targetCenterY)

Calculations:
1. Normalize coordinates relative to target center
2. Calculate group center (mean x, mean y)
3. Calculate average distance from group center
4. Calculate eccentricity (ellipse ratio):
   - Fit ellipse to shot group
   - eccentricity = major axis / minor axis
   - 1.0 = circular, >1.0 = elliptical
5. Detect bias:
   - horizontalBias = mean(x - groupCenterX)
   - verticalBias = mean(y - groupCenterY)
6. Calculate primary axis angle (for elliptical groups)

Results:
→ AdvancedShotGrouping data class
→ Provides insights:
   - &quot;Circular grouping&quot; vs &quot;Highly directional&quot;
   - &quot;Bias high and right&quot; direction indicators
   - &quot;Excellent&quot; / &quot;Good&quot; / &quot;Fair&quot; / &quot;Needs improvement&quot; quality
</code></pre>
<p><strong>Fatigue Detection</strong> (EquipmentStatsModels.kt:155-175):</p>
<pre><code>Compares recent performance to earlier performance:

1. Split arrows into:
   - Recent shots: Last 20% of session
   - Earlier shots: First 80% of session
   
2. Calculate metrics for each:
   - Average score
   - Average group size (if coordinates available)
   
3. Compare:
   - performanceDrop = (earlierAvg - recentAvg) / earlierAvg
   - groupingDeterioration = (recentGroupSize - earlierGroupSize) / earlierGroupSize
   
4. Compute fatigue score:
   - fatigueScore = weighted average of drops
   - 0-1 scale (0 = no fatigue, 1 = high fatigue)
   
5. Generate recommendations:
   - &lt; 0.3: &quot;Maintain current intensity&quot;
   - 0.3-0.6: &quot;Consider shorter sessions&quot;
   - > 0.6: &quot;Reduce shot count or rest&quot;
</code></pre>
<p><strong>Consistency Analysis</strong> (EquipmentStatsModels.kt:180-202):</p>
<pre><code>Analyzes end-to-end performance:

1. Group arrows by end number
2. Calculate score for each end
3. Compute variation:
   - Standard deviation of end scores
   - Coefficient of variation
   
4. Detect trends:
   - Linear regression of end scores over time
   - trend = slope of regression line
   - Positive = improving, Negative = declining
   
5. Identify outliers:
   - mostConsistentEnd = end with lowest variation
   - leastConsistentEnd = end with highest variation
</code></pre>
<h3 id="distance-specific-performance">Distance-Specific Performance<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#distance-specific-performance" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<pre><code>EquipmentDistancePerformance (EquipmentStatsModels.kt:76-85)

Query:
→ JOIN arrow_equipment_snapshot 
  WITH arrow_scores (via arrowScoreId)
  WITH end_scores (via endScoreId)
  WITH rounds (via roundId)
  
→ GROUP BY bowSetupId, distance, distanceUnit

Aggregations:
- arrowCount: COUNT(*)
- averageScore: AVG(scoreValue)
- tenCount: COUNT WHERE scoreValue = 10
- xCount: COUNT WHERE isX = true
- nineOrBetterCount: COUNT WHERE scoreValue >= 9

Per Distance Results:
- 18 meters: 95% accuracy, avg 9.5
- 30 meters: 88% accuracy, avg 9.0
- 50 meters: 72% accuracy, avg 8.2
- 70 meters: 65% accuracy, avg 7.8

Insights:
→ Identifies optimal distance for equipment
→ Highlights distance-specific weaknesses
→ Guides practice focus
</code></pre>
<h3 id="cache-management">Cache Management<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#cache-management" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><strong>Cache Strategy:</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="kotlin" data-theme="github-light github-dark"><code data-language="kotlin" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@Entity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tableName </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;equipment_stats_cache&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> EquipmentStatsCache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @PrimaryKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(autoGenerate </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> id: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cacheKey: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Unique identifier for query</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> equipmentType: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,             </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// &quot;bow_setup&quot;, &quot;riser&quot;, etc.</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> equipmentId: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                 </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// FK to equipment</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> statsData: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                 </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// JSON-serialized stats</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> createdAt: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Cache creation time</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> validUntil: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Expiration timestamp</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lastRoundId: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">? </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          // For invalidation</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></figure>
<p><strong>Cache Lifecycle:</strong></p>
<pre><code>1. Statistics Request:
   → Check cache: EquipmentStatsDao.getValidCacheEntry(cacheKey, now)
   → If valid (validUntil > now): Return cached data
   → If invalid/missing: Proceed to calculation
   
2. Calculate Statistics:
   → Query raw data from database
   → Aggregate and calculate metrics
   → Serialize to JSON
   
3. Store in Cache:
   → Create EquipmentStatsCache entry
   → Set validUntil = now + cacheDuration (e.g., 1 hour)
   → insertStatsCache(cache)
   
4. Cache Invalidation:
   Triggers:
   - Equipment modified: deleteCacheForEquipment(setupId)
   - New round completed: getCacheKeysForRound(roundId) + invalidate
   - Manual refresh: deleteCacheByKey(cacheKey)
   
5. Periodic Cleanup:
   → App startup or background task
   → deleteExpiredCache(now)
   → Removes entries where validUntil &lt;= now
</code></pre>
<hr/>
<h2 id="edge-cases--error-handling">Edge Cases &amp; Error Handling<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#edge-cases--error-handling" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="equipment-in-use---cannot-delete">Equipment in Use - Cannot Delete<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#equipment-in-use---cannot-delete" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><strong>Scenario:</strong> User attempts to delete bow setup used in rounds</p>
<p><strong>Handling:</strong></p>
<pre><code>1. Check usage:
   → Query: SELECT COUNT(*) FROM rounds WHERE bowSetupId = :setupId
   
2. If count > 0:
   → Show dialog: &quot;Equipment used in X rounds. Cannot delete.&quot;
   → Options:
      - &quot;Archive&quot; (soft delete: isActive = false)
      - &quot;Cancel&quot;
   
3. If count = 0:
   → Proceed with deletion
   → bowSetupDao.softDeleteBowSetup(id)
</code></pre>
<p><strong>File Reference:</strong> BowSetupRepository.kt:86 (soft delete method)</p>
<h3 id="missing-equipment-in-historical-rounds">Missing Equipment in Historical Rounds<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#missing-equipment-in-historical-rounds" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><strong>Scenario:</strong> Equipment deleted/archived, historical round references it</p>
<p><strong>Handling:</strong></p>
<pre><code>1. Database integrity:
   → Foreign key constraint allows NULL for Round.bowSetupId
   → Historical data preserved
   
2. Display logic:
   → When loading round: getBowSetupById(roundId) may return null
   → UI displays &quot;Equipment No Longer Available&quot; or &quot;Unknown Equipment&quot;
   
3. Statistics:
   → ArrowEquipmentSnapshot preserves equipment IDs
   → Statistics still calculable from snapshots
   → Historical performance preserved even if equipment deleted
</code></pre>
<p><strong>File Reference:</strong> BowSetupDao.kt:72 (includes inactive)</p>
<h3 id="validation-rules-for-equipment-specs">Validation Rules for Equipment Specs<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#validation-rules-for-equipment-specs" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><strong>Single-Item Equipment Types:</strong></p>
<ul>
<li>RISER, LIMBS, SIGHT, PLUNGER, REST, BOW_STRING, ARROW</li>
<li>Only one of each type allowed per setup</li>
<li>Adding second item of same type replaces first</li>
</ul>
<p><strong>Implementation:</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="kotlin" data-theme="github-light github-dark"><code data-language="kotlin" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> isSingleItemEquipment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(equipmentType: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">EquipmentType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">): </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> when</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (equipmentType) {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        EquipmentType.RISER,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        EquipmentType.LIMBS,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        EquipmentType.SIGHT,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        EquipmentType.PLUNGER,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        EquipmentType.REST,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        EquipmentType.BOW_STRING,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        EquipmentType.ARROW </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-></span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        EquipmentType.STABILIZER,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        EquipmentType.WEIGHT,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        EquipmentType.ACCESSORY </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-></span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Multi-item allowed</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">suspend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> addEquipmentToSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">..</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.) {</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isSingleItemEquipment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(equipmentType)) {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        bowSetupDao.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">deleteEquipmentByType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(setupId, equipmentType)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Remove existing</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    bowSetupDao.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">insertBowSetupEquipment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">..</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Insert new</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></figure>
<p><strong>File Reference:</strong> BowSetupRepository.kt:359-373</p>
<p><strong>Multi-Item Equipment Types:</strong></p>
<ul>
<li>STABILIZER, WEIGHT, ACCESSORY</li>
<li>Multiple items of same type allowed</li>
<li>Each has quantity field</li>
</ul>
<h3 id="statistics-with-incomplete-data">Statistics with Incomplete Data<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#statistics-with-incomplete-data" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><strong>Missing Arrow Coordinates:</strong></p>
<ul>
<li>Basic statistics (score, X count, etc.) always available</li>
<li>Advanced grouping requires coordinates</li>
<li>UI shows “Coordinate data not available for advanced grouping”</li>
</ul>
<p><strong>Insufficient Data:</strong></p>
<ul>
<li>Minimum arrows for meaningful statistics: 10</li>
<li>UI shows “More data needed (X/10 arrows)” if below threshold</li>
<li>Fatigue analysis requires 20+ arrows</li>
<li>Consistency requires 2+ ends</li>
</ul>
<p><strong>Calculation Safeguards:</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="kotlin" data-theme="github-light github-dark"><code data-language="kotlin" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Prevent division by zero</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> accuracy: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Double</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (totalArrows </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">></span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    (tenCount.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toDouble</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> totalArrows) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.0</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Check minimum data requirements</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> canCalculateFatigue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(): </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Boolean</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> totalArrows </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">>=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 20</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> canCalculateGrouping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(): </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Boolean</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> arrowsWithCoordinates </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">>=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span></span></code></pre></figure>
<hr/>
<h2 id="testing-coverage">Testing Coverage<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#testing-coverage" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="unit-tests">Unit Tests<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#unit-tests" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><strong>Repository Tests:</strong></p>
<ul>
<li><code>BowSetupRepositoryTest</code>
<ul>
<li>CRUD operations</li>
<li>Guest setup creation/cleanup</li>
<li>Equipment association</li>
<li>Versioning logic</li>
</ul>
</li>
</ul>
<p><strong>ViewModel Tests:</strong></p>
<ul>
<li><code>BowSetupViewModelTest</code>
<ul>
<li>State management (StateFlow updates)</li>
<li>Input validation</li>
<li>Save/update/delete operations</li>
<li>Component selection</li>
</ul>
</li>
</ul>
<p><strong>DAO Tests:</strong></p>
<ul>
<li><code>BowSetupDaoTest</code>
<ul>
<li>Database queries</li>
<li>Guest setup filtering</li>
<li>Equipment junction operations</li>
</ul>
</li>
</ul>
<h3 id="integration-tests">Integration Tests<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#integration-tests" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><strong>Equipment Flow Tests:</strong></p>
<ul>
<li>Create setup → Add components → Save → Verify database</li>
<li>Select equipment → Associate with round → Shoot arrows → Verify snapshots</li>
<li>Load statistics → Verify aggregations → Check cache</li>
</ul>
<h3 id="ui-tests">UI Tests<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#ui-tests" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><strong>Screen Tests:</strong></p>
<ul>
<li><code>BowSetupDetailScreenTest</code>
<ul>
<li>UI composition</li>
<li>Input validation</li>
<li>Component selection navigation</li>
</ul>
</li>
<li><code>EquipmentListScreenTest</code>
<ul>
<li>List display</li>
<li>Search/filter</li>
<li>Navigation to detail</li>
</ul>
</li>
</ul>
<hr/>
<h2 id="future-enhancements">Future Enhancements<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#future-enhancements" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="equipment-recommendations">Equipment Recommendations<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#equipment-recommendations" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><strong>Based on Performance:</strong></p>
<ul>
<li>Analyze statistics across equipment</li>
<li>Identify best-performing configurations</li>
<li>Suggest optimal equipment for specific distances</li>
</ul>
<p><strong>Implementation:</strong></p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="kotlin" data-theme="github-light github-dark"><code data-language="kotlin" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> EquipmentRecommendation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bowSetupId: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> confidenceScore: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Double</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 0-1</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> reason: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> performanceGain: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Double</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   // Expected improvement percentage</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> generateRecommendations</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    userStats: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">List</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">EquipmentPerformanceStats</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">>,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    targetDistance: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Distance</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">): </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">List</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">EquipmentRecommendation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<h3 id="equipment-marketplacedatabase">Equipment Marketplace/Database<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#equipment-marketplacedatabase" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><strong>Community Equipment Sharing:</strong></p>
<ul>
<li>Public equipment database</li>
<li>User-submitted configurations</li>
<li>Performance ratings and reviews</li>
<li>Equipment recommendations based on skill level</li>
</ul>
<h3 id="photo-attachments">Photo Attachments<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#photo-attachments" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><strong>Visual Equipment Tracking:</strong></p>
<ul>
<li>Add photo field to equipment entities</li>
<li>Camera integration for quick capture</li>
<li>Photo gallery view in equipment detail</li>
<li>Before/after comparisons for tuning</li>
</ul>
<h3 id="advanced-analytics-1">Advanced Analytics<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#advanced-analytics-1" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><strong>Machine Learning:</strong></p>
<ul>
<li>Predict optimal equipment combinations</li>
<li>Fatigue pattern recognition</li>
<li>Shot prediction based on conditions</li>
<li>Personalized coaching recommendations</li>
</ul>
<hr/>
<h2 id="key-code-references">Key Code References<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#key-code-references" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="data-models">Data Models<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#data-models" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<ul>
<li><code>BowSetup.kt:18-52</code> - Core equipment container</li>
<li><code>BowSetupWithEquipment.kt:4-16</code> - Composite view model</li>
<li><code>EquipmentStatsModels.kt:39-54</code> - Performance stats</li>
<li><code>EquipmentStatsModels.kt:94-202</code> - Advanced analytics</li>
</ul>
<h3 id="database-layer">Database Layer<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#database-layer" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<ul>
<li><code>BowSetupDao.kt:15-115</code> - Setup operations</li>
<li><code>BowSetupDao.kt:75-114</code> - Guest setup queries</li>
<li><code>EquipmentStatsDao.kt:20-45</code> - Snapshot operations</li>
<li><code>EquipmentStatsDao.kt:59-83</code> - Cache management</li>
</ul>
<h3 id="repository-layer">Repository Layer<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#repository-layer" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<ul>
<li><code>BowSetupRepository.kt:56-90</code> - Core operations</li>
<li><code>BowSetupRepository.kt:99-158</code> - Guest setup management</li>
<li><code>BowSetupRepository.kt:219-257</code> - Equipment management</li>
<li><code>BowSetupRepository.kt:260-312</code> - Complete setup assembly</li>
<li><code>BowSetupRepository.kt:315-348</code> - Versioning</li>
</ul>
<h3 id="viewmodel-layer">ViewModel Layer<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#viewmodel-layer" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<ul>
<li>See <a href="../../../Equipment-ViewModels" class="internal" data-slug="Equipment-ViewModels">Equipment-ViewModels</a> for complete documentation</li>
<li><code>BowSetupViewModel.kt</code> - Setup coordination</li>
<li><code>componentViewModels/*.kt</code> - Individual component ViewModels</li>
</ul>
<h3 id="ui-layer">UI Layer<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#ui-layer" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<ul>
<li><code>BowSetupDetailScreen.kt</code> - Setup creation/editing</li>
<li><code>EquipmentManagementScreen.kt</code> - Entry point</li>
<li><code>equipment/analytics/*.kt</code> - Analytics screens</li>
</ul>
<hr/>
<h2 id="summary">Summary<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#summary" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>The Equipment Management system is a comprehensive, multi-layered architecture for tracking archery equipment, associating equipment with scoring rounds, and analyzing performance statistics. The system supports:</p>
<p>✅ <strong>Complete Equipment Tracking</strong> - 10+ equipment types with versioning
✅ <strong>Seamless Round Integration</strong> - Equipment selection and association
✅ <strong>Multi-Participant Support</strong> - Auto-generated guest setups
✅ <strong>Historical Accuracy</strong> - Equipment snapshots preserve history
✅ <strong>Performance Analytics</strong> - Basic and advanced statistics
✅ <strong>Cache Optimization</strong> - Fast statistics retrieval
✅ <strong>Data Integrity</strong> - Soft deletion, validation, FK constraints</p>
<p><strong>Architecture Layers:</strong> Data Models → Database → Repository → ViewModel → UI
<strong>Key Patterns:</strong> StateFlow, SaveResult, InputState, Repository Pattern
<strong>Testing:</strong> Unit, Integration, and UI tests</p>
<p><strong>Visual Diagrams Added:</strong></p>
<ul>
<li>Architecture overview with layer interactions</li>
<li>Complete user journey flowcharts (4 journeys)</li>
<li>Multi-participant guest setup flow</li>
<li>Equipment snapshot and statistics aggregation flow</li>
</ul>
<hr/>
<p><strong>Status:</strong> ✅ <strong>ACTIVE</strong> | Production-ready equipment management system with comprehensive visual documentation
<strong>Last Updated:</strong> October 13, 2025
<strong>Documentation Version:</strong> 1.1 - Added Mermaid diagrams</p></article><hr/><div class="page-footer"></div></div><div class="right sidebar"><div class="graph"><h3>Graph View</h3><div class="graph-outer"><div class="graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:1,&quot;scale&quot;:1.1,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:false,&quot;enableRadial&quot;:false}"></div><button class="global-graph-icon" aria-label="Global Graph"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55 55" fill="currentColor" xml:space="preserve"><path d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
                s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
                c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
                C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
                c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
                v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
                s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
                C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
                S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
                s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
                s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"></path></svg></button></div><div class="global-graph-outer"><div class="global-graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:-1,&quot;scale&quot;:0.9,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.2,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:true,&quot;enableRadial&quot;:true}"></div></div></div><div class="toc desktop-only"><button type="button" class="toc-header" aria-controls="toc-48" aria-expanded="true"><h3>Table of Contents</h3><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><ul id="list-1" class="toc-content overflow"><li class="depth-0"><a href="#equipment-management-end-to-end-flow" data-for="equipment-management-end-to-end-flow">Equipment Management: End-to-End Flow</a></li><li class="depth-1"><a href="#overview" data-for="overview">Overview</a></li><li class="depth-1"><a href="#architecture-layers" data-for="architecture-layers">Architecture Layers</a></li><li class="depth-2"><a href="#system-architecture-overview" data-for="system-architecture-overview">System Architecture Overview</a></li><li class="depth-2"><a href="#layer-interaction-flow" data-for="layer-interaction-flow">Layer Interaction Flow</a></li><li class="depth-2"><a href="#1-data-models" data-for="1-data-models">1. Data Models</a></li><li class="depth-2"><a href="#2-database-layer" data-for="2-database-layer">2. Database Layer</a></li><li class="depth-2"><a href="#3-repository-layer" data-for="3-repository-layer">3. Repository Layer</a></li><li class="depth-2"><a href="#4-viewmodel-layer" data-for="4-viewmodel-layer">4. ViewModel Layer</a></li><li class="depth-2"><a href="#5-ui-layer" data-for="5-ui-layer">5. UI Layer</a></li><li class="depth-1"><a href="#user-journeys" data-for="user-journeys">User Journeys</a></li><li class="depth-2"><a href="#journey-1-create-new-bow-setup" data-for="journey-1-create-new-bow-setup">Journey 1: Create New Bow Setup</a></li><li class="depth-2"><a href="#journey-2-select-equipment-for-round" data-for="journey-2-select-equipment-for-round">Journey 2: Select Equipment for Round</a></li><li class="depth-2"><a href="#journey-3-view-equipment-statistics" data-for="journey-3-view-equipment-statistics">Journey 3: View Equipment Statistics</a></li><li class="depth-2"><a href="#journey-4-edit-equipment" data-for="journey-4-edit-equipment">Journey 4: Edit Equipment</a></li><li class="depth-1"><a href="#multi-participant-equipment-flow" data-for="multi-participant-equipment-flow">Multi-Participant Equipment Flow</a></li><li class="depth-2"><a href="#guest-setup-auto-creation" data-for="guest-setup-auto-creation">Guest Setup Auto-Creation</a></li><li class="depth-1"><a href="#statistics-tracking-deep-dive" data-for="statistics-tracking-deep-dive">Statistics Tracking Deep Dive</a></li><li class="depth-2"><a href="#equipment-snapshot--statistics-flow" data-for="equipment-snapshot--statistics-flow">Equipment Snapshot &amp; Statistics Flow</a></li><li class="depth-2"><a href="#equipment-snapshot-capture" data-for="equipment-snapshot-capture">Equipment Snapshot Capture</a></li><li class="depth-2"><a href="#performance-metrics-calculation" data-for="performance-metrics-calculation">Performance Metrics Calculation</a></li><li class="depth-2"><a href="#advanced-analytics" data-for="advanced-analytics">Advanced Analytics</a></li><li class="depth-2"><a href="#distance-specific-performance" data-for="distance-specific-performance">Distance-Specific Performance</a></li><li class="depth-2"><a href="#cache-management" data-for="cache-management">Cache Management</a></li><li class="depth-1"><a href="#edge-cases--error-handling" data-for="edge-cases--error-handling">Edge Cases &amp; Error Handling</a></li><li class="depth-2"><a href="#equipment-in-use---cannot-delete" data-for="equipment-in-use---cannot-delete">Equipment in Use - Cannot Delete</a></li><li class="depth-2"><a href="#missing-equipment-in-historical-rounds" data-for="missing-equipment-in-historical-rounds">Missing Equipment in Historical Rounds</a></li><li class="depth-2"><a href="#validation-rules-for-equipment-specs" data-for="validation-rules-for-equipment-specs">Validation Rules for Equipment Specs</a></li><li class="depth-2"><a href="#statistics-with-incomplete-data" data-for="statistics-with-incomplete-data">Statistics with Incomplete Data</a></li><li class="depth-1"><a href="#testing-coverage" data-for="testing-coverage">Testing Coverage</a></li><li class="depth-2"><a href="#unit-tests" data-for="unit-tests">Unit Tests</a></li><li class="depth-2"><a href="#integration-tests" data-for="integration-tests">Integration Tests</a></li><li class="depth-2"><a href="#ui-tests" data-for="ui-tests">UI Tests</a></li><li class="depth-1"><a href="#future-enhancements" data-for="future-enhancements">Future Enhancements</a></li><li class="depth-2"><a href="#equipment-recommendations" data-for="equipment-recommendations">Equipment Recommendations</a></li><li class="depth-2"><a href="#equipment-marketplacedatabase" data-for="equipment-marketplacedatabase">Equipment Marketplace/Database</a></li><li class="depth-2"><a href="#photo-attachments" data-for="photo-attachments">Photo Attachments</a></li><li class="depth-2"><a href="#advanced-analytics-1" data-for="advanced-analytics-1">Advanced Analytics</a></li><li class="depth-1"><a href="#key-code-references" data-for="key-code-references">Key Code References</a></li><li class="depth-2"><a href="#data-models" data-for="data-models">Data Models</a></li><li class="depth-2"><a href="#database-layer" data-for="database-layer">Database Layer</a></li><li class="depth-2"><a href="#repository-layer" data-for="repository-layer">Repository Layer</a></li><li class="depth-2"><a href="#viewmodel-layer" data-for="viewmodel-layer">ViewModel Layer</a></li><li class="depth-2"><a href="#ui-layer" data-for="ui-layer">UI Layer</a></li><li class="depth-1"><a href="#summary" data-for="summary">Summary</a></li><li class="overflow-end"></li></ul></div></div><footer class><p>Created with <a href="https://quartz.jzhao.xyz/">Quartz v4.5.2</a> © 2025</p><ul><li><a href="https://github.com/jackyzha0/quartz">GitHub</a></li><li><a href="https://discord.gg/cRFFHYye7t">Discord Community</a></li></ul></footer></div></div></body><script type="application/javascript">function n(){let t=this.parentElement;t.classList.toggle("is-collapsed");let e=t.getElementsByClassName("callout-content")[0];if(!e)return;let l=t.classList.contains("is-collapsed");e.style.gridTemplateRows=l?"0fr":"1fr"}function c(){let t=document.getElementsByClassName("callout is-collapsible");for(let e of t){let l=e.getElementsByClassName("callout-title")[0],s=e.getElementsByClassName("callout-content")[0];if(!l||!s)continue;l.addEventListener("click",n),window.addCleanup(()=>l.removeEventListener("click",n));let o=e.classList.contains("is-collapsed");s.style.gridTemplateRows=o?"0fr":"1fr"}}document.addEventListener("nav",c);
</script><script type="module">function f(i,e){if(!i)return;function r(o){o.target===this&&(o.preventDefault(),o.stopPropagation(),e())}function t(o){o.key.startsWith("Esc")&&(o.preventDefault(),e())}i?.addEventListener("click",r),window.addCleanup(()=>i?.removeEventListener("click",r)),document.addEventListener("keydown",t),window.addCleanup(()=>document.removeEventListener("keydown",t))}function y(i){for(;i.firstChild;)i.removeChild(i.firstChild)}var h=class{constructor(e,r){this.container=e;this.content=r;this.setupEventListeners(),this.setupNavigationControls(),this.resetTransform()}isDragging=!1;startPan={x:0,y:0};currentPan={x:0,y:0};scale=1;MIN_SCALE=.5;MAX_SCALE=3;cleanups=[];setupEventListeners(){let e=this.onMouseDown.bind(this),r=this.onMouseMove.bind(this),t=this.onMouseUp.bind(this),o=this.resetTransform.bind(this);this.container.addEventListener("mousedown",e),document.addEventListener("mousemove",r),document.addEventListener("mouseup",t),window.addEventListener("resize",o),this.cleanups.push(()=>this.container.removeEventListener("mousedown",e),()=>document.removeEventListener("mousemove",r),()=>document.removeEventListener("mouseup",t),()=>window.removeEventListener("resize",o))}cleanup(){for(let e of this.cleanups)e()}setupNavigationControls(){let e=document.createElement("div");e.className="mermaid-controls";let r=this.createButton("+",()=>this.zoom(.1)),t=this.createButton("-",()=>this.zoom(-.1)),o=this.createButton("Reset",()=>this.resetTransform());e.appendChild(t),e.appendChild(o),e.appendChild(r),this.container.appendChild(e)}createButton(e,r){let t=document.createElement("button");return t.textContent=e,t.className="mermaid-control-button",t.addEventListener("click",r),window.addCleanup(()=>t.removeEventListener("click",r)),t}onMouseDown(e){e.button===0&&(this.isDragging=!0,this.startPan={x:e.clientX-this.currentPan.x,y:e.clientY-this.currentPan.y},this.container.style.cursor="grabbing")}onMouseMove(e){this.isDragging&&(e.preventDefault(),this.currentPan={x:e.clientX-this.startPan.x,y:e.clientY-this.startPan.y},this.updateTransform())}onMouseUp(){this.isDragging=!1,this.container.style.cursor="grab"}zoom(e){let r=Math.min(Math.max(this.scale+e,this.MIN_SCALE),this.MAX_SCALE),t=this.content.getBoundingClientRect(),o=t.width/2,n=t.height/2,c=r-this.scale;this.currentPan.x-=o*c,this.currentPan.y-=n*c,this.scale=r,this.updateTransform()}updateTransform(){this.content.style.transform=`translate(${this.currentPan.x}px, ${this.currentPan.y}px) scale(${this.scale})`}resetTransform(){this.scale=1;let e=this.content.querySelector("svg");this.currentPan={x:e.getBoundingClientRect().width/2,y:e.getBoundingClientRect().height/2},this.updateTransform()}},C=["--secondary","--tertiary","--gray","--light","--lightgray","--highlight","--dark","--darkgray","--codeFont"],E;document.addEventListener("nav",async()=>{let e=document.querySelector(".center").querySelectorAll("code.mermaid");if(e.length===0)return;E||=await import("https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.4.0/mermaid.esm.min.mjs");let r=E.default,t=new WeakMap;for(let n of e)t.set(n,n.innerText);async function o(){for(let s of e){s.removeAttribute("data-processed");let a=t.get(s);a&&(s.innerHTML=a)}let n=C.reduce((s,a)=>(s[a]=window.getComputedStyle(document.documentElement).getPropertyValue(a),s),{}),c=document.documentElement.getAttribute("saved-theme")==="dark";r.initialize({startOnLoad:!1,securityLevel:"loose",theme:c?"dark":"base",themeVariables:{fontFamily:n["--codeFont"],primaryColor:n["--light"],primaryTextColor:n["--darkgray"],primaryBorderColor:n["--tertiary"],lineColor:n["--darkgray"],secondaryColor:n["--secondary"],tertiaryColor:n["--tertiary"],clusterBkg:n["--light"],edgeLabelBackground:n["--highlight"]}}),await r.run({nodes:e})}await o(),document.addEventListener("themechange",o),window.addCleanup(()=>document.removeEventListener("themechange",o));for(let n=0;n<e.length;n++){let v=function(){let g=l.querySelector("#mermaid-space"),m=l.querySelector(".mermaid-content");if(!m)return;y(m);let w=c.querySelector("svg").cloneNode(!0);m.appendChild(w),l.classList.add("active"),g.style.cursor="grab",u=new h(g,m)},M=function(){l.classList.remove("active"),u?.cleanup(),u=null},c=e[n],s=c.parentElement,a=s.querySelector(".clipboard-button"),d=s.querySelector(".expand-button"),p=window.getComputedStyle(a),L=a.offsetWidth+parseFloat(p.marginLeft||"0")+parseFloat(p.marginRight||"0");d.style.right=`calc(${L}px + 0.3rem)`,s.prepend(d);let l=s.querySelector("#mermaid-container");if(!l)return;let u=null;d.addEventListener("click",v),f(l,M),window.addCleanup(()=>{u?.cleanup(),d.removeEventListener("click",v)})}});
</script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/copy-tex.min.js" type="application/javascript"></script><script src="../../../postscript.js" type="module"></script></html>